2025-10-11 14:41:15,745 - __main__ - INFO - ThermoSystem initialized
2025-10-11 14:41:15,746 - __main__ - INFO - Initializing agents...
2025-10-11 14:41:16,011 - thermo_agent - INFO - ThermodynamicAgent 'thermo_agent' initialized
2025-10-11 14:41:16,012 - sql_agent - INFO - SQLGenerationAgent 'sql_agent' initialized
2025-10-11 14:41:16,012 - database_agent - INFO - DatabaseAgent 'database_agent' initialized
2025-10-11 14:41:16,013 - results_filtering_agent - INFO - ResultsFilteringAgent 'results_filtering_agent' initialized
2025-10-11 14:41:16,013 - individual_search_agent - INFO - IndividualSearchAgent 'individual_search_agent' initialized
2025-10-11 14:41:16,017 - __main__ - INFO - All agents initialized successfully
2025-10-11 14:41:16,018 - __main__ - INFO - Starting agents...
2025-10-11 14:41:16,018 - thermo_agent - INFO - Agent 'thermo_agent' started listening for messages
2025-10-11 14:41:16,018 - sql_agent - INFO - Agent 'sql_agent' started listening for messages
2025-10-11 14:41:16,018 - database_agent - INFO - Agent 'database_agent' started listening for messages
2025-10-11 14:41:16,018 - results_filtering_agent - INFO - Agent 'results_filtering_agent' started listening for messages
2025-10-11 14:41:16,018 - individual_search_agent - INFO - Agent 'individual_search_agent' started listening for messages
2025-10-11 14:41:17,018 - __main__ - INFO - All agents started
2025-10-11 14:41:33 - INFO - ОПЕРАЦИЯ: [orchestrator] -> PROCESS_REQUEST
2025-10-11 14:41:33,832 - thermo_agents_session_20251011_144115 - INFO - ОПЕРАЦИЯ: [orchestrator] -> PROCESS_REQUEST
2025-10-11 14:41:33,833 - orchestrator - INFO - DEBUG: Waiting for thermo_agent response, timeout=180s, message_id=b4fe6625-0352-4f97-89f0-bce8eae1b61e
2025-10-11 14:41:33 - INFO - ОПЕРАЦИЯ: [thermo_agent] -> EXTRACT_PARAMETERS [from orchestrator]
2025-10-11 14:41:33,833 - thermo_agents_session_20251011_144115 - INFO - ОПЕРАЦИЯ: [thermo_agent] -> EXTRACT_PARAMETERS [from orchestrator]
2025-10-11 14:41:33,833 - thermo_agent - INFO - Starting parameter extraction for query: При какой температуре провзаимодействует оксид кальция и сульфид железа?...
2025-10-11 14:41:36,237 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-11 14:41:43,855 - thermo_agent - ERROR - LLM timeout after 10 seconds, using fallback extraction
2025-10-11 14:41:43,855 - thermo_agent - WARNING - Using fallback extraction for query: При какой температуре провзаимодействует оксид кальция и сульфид железа?...
2025-10-11 14:41:43 - INFO - INFO: EXTRACTION COMPLETE: reaction, 0 compounds
2025-10-11 14:41:43,858 - thermo_agents_session_20251011_144115 - INFO - INFO: EXTRACTION COMPLETE: reaction, 0 compounds
2025-10-11 14:41:43,859 - thermo_agent - INFO - Forwarded to SQL agent: 05819dc1-b37c-4cd9-b54e-00fb583a667c
2025-10-11 14:41:43 - INFO - РЕЗУЛЬТАТ: { "intent": "reaction", "compounds_count": 0, "compounds": 0 items, "temperature_k": 298.15, "has_sql_hint": True, ... }
2025-10-11 14:41:43,860 - thermo_agents_session_20251011_144115 - INFO - РЕЗУЛЬТАТ: { "intent": "reaction", "compounds_count": 0, "compounds": 0 items, "temperature_k": 298.15, "has_sql_hint": True, ... }
2025-10-11 14:41:43 - INFO - ВРЕМЯ ВЫПОЛНЕНИЯ: 10026.48ms
2025-10-11 14:41:43,861 - thermo_agents_session_20251011_144115 - INFO - ВРЕМЯ ВЫПОЛНЕНИЯ: 10026.48ms
2025-10-11 14:41:43 - INFO - МАРШРУТ: FROM: orchestrator
2025-10-11 14:41:43,862 - thermo_agents_session_20251011_144115 - INFO - МАРШРУТ: FROM: orchestrator
2025-10-11 14:41:43 - INFO - CORRELATION ID: b4fe6625-0352-4f97-89f0-bce8eae1b61e
2025-10-11 14:41:43,863 - thermo_agents_session_20251011_144115 - INFO - CORRELATION ID: b4fe6625-0352-4f97-89f0-bce8eae1b61e
2025-10-11 14:41:43 - INFO - AGENT STORAGE: 2 entries, 2 pending messages, 6 active sessions
2025-10-11 14:41:43,863 - thermo_agents_session_20251011_144115 - INFO - AGENT STORAGE: 2 entries, 2 pending messages, 6 active sessions
2025-10-11 14:41:43 - INFO - ACTIVE AGENTS: thermo_agent, sql_agent, database_agent, results_filtering_agent, individual_search_agent, orchestrator
2025-10-11 14:41:43,863 - thermo_agents_session_20251011_144115 - INFO - ACTIVE AGENTS: thermo_agent, sql_agent, database_agent, results_filtering_agent, individual_search_agent, orchestrator
2025-10-11 14:41:43 - INFO - ОПЕРАЦИЯ: [sql_agent] -> GENERATE_QUERY [from thermo_agent]
2025-10-11 14:41:43,866 - thermo_agents_session_20251011_144115 - INFO - ОПЕРАЦИЯ: [sql_agent] -> GENERATE_QUERY [from thermo_agent]
2025-10-11 14:41:43,866 - sql_agent - INFO - Processing SQL hint: Fallback extraction: При какой температуре провзаимодействует оксид кальция и сульфид железа?...
2025-10-11 14:41:43 - INFO - INFO: SQL GENERATION START: Processing message 05819dc1-b37c-4cd9-b54e-00fb583a667c
2025-10-11 14:41:43,867 - thermo_agents_session_20251011_144115 - INFO - INFO: SQL GENERATION START: Processing message 05819dc1-b37c-4cd9-b54e-00fb583a667c
2025-10-11 14:41:43,867 - sql_agent - INFO - Starting SQL query generation...
2025-10-11 14:41:43,868 - orchestrator - INFO - DEBUG: Received response from thermo_agent: success
2025-10-11 14:41:43 - INFO - INFO: THERMO AGENT RESPONSE: Success with 0 compounds
2025-10-11 14:41:43,869 - thermo_agents_session_20251011_144115 - INFO - INFO: THERMO AGENT RESPONSE: Success with 0 compounds
2025-10-11 14:41:44,456 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-11 14:41:49,270 - httpx - INFO - HTTP Request: POST https://openrouter.ai/api/v1/chat/completions "HTTP/1.1 200 OK"
2025-10-11 14:41:49,949 - sql_agent - INFO - Generated SQL query: 
2025-10-11 14:41:49 - INFO - INFO: SQL GENERATION COMPLETE: Query length 0
2025-10-11 14:41:49,950 - thermo_agents_session_20251011_144115 - INFO - INFO: SQL GENERATION COMPLETE: Query length 0
2025-10-11 14:41:49,951 - sql_agent - INFO - SQL query cleaned
2025-10-11 14:41:49,952 - sql_agent - INFO - Prepared result data with key: sql_result_05819dc1-b37c-4cd9-b54e-00fb583a667c
2025-10-11 14:41:49,952 - sql_agent - INFO - Sending SQL query to database agent for execution...
2025-10-11 14:41:49,952 - sql_agent - INFO - SQL query sent to database_agent: 746dcb29-c10f-4a22-b54d-066cabad4e37
2025-10-11 14:41:51 - INFO - ОПЕРАЦИЯ: [database_agent] -> EXECUTE_QUERY [from sql_agent]
2025-10-11 14:41:51,919 - thermo_agents_session_20251011_144115 - INFO - ОПЕРАЦИЯ: [database_agent] -> EXECUTE_QUERY [from sql_agent]
2025-10-11 14:41:51,920 - database_agent - INFO - Executing standard SQL query: 
2025-10-11 14:41:51,921 - database_agent - ERROR - Error processing database message 746dcb29-c10f-4a22-b54d-066cabad4e37: No sql_query in message payload
2025-10-11 14:41:51 - ERROR - ОПЕРАЦИЯ ЗАВЕРШИЛАСЬ С ОШИБКОЙ: ОПЕРАЦИЯ: [database_agent] -> EXECUTE_QUERY [from sql_agent]
2025-10-11 14:41:51,924 - thermo_agents_session_20251011_144115 - ERROR - ОПЕРАЦИЯ ЗАВЕРШИЛАСЬ С ОШИБКОЙ: ОПЕРАЦИЯ: [database_agent] -> EXECUTE_QUERY [from sql_agent]
2025-10-11 14:41:51 - ERROR - ДЕТАЛИ ОШИБКИ:
2025-10-11 14:41:51,925 - thermo_agents_session_20251011_144115 - ERROR - ДЕТАЛИ ОШИБКИ:
2025-10-11 14:41:51 - ERROR - {
  "exception_type": "ValueError",
  "exception_message": "No sql_query in message payload",
  "traceback": [
    "Traceback (most recent call last):\n",
    "  File \"c:\\IDE\\repository\\agents_for_david\\src\\thermo_agents\\database_agent.py\", line 161, in _process_message\n    raise ValueError(\"No sql_query in message payload\")\n",
    "ValueError: No sql_query in message payload\n"
  ]
}
2025-10-11 14:41:51,925 - thermo_agents_session_20251011_144115 - ERROR - {
  "exception_type": "ValueError",
  "exception_message": "No sql_query in message payload",
  "traceback": [
    "Traceback (most recent call last):\n",
    "  File \"c:\\IDE\\repository\\agents_for_david\\src\\thermo_agents\\database_agent.py\", line 161, in _process_message\n    raise ValueError(\"No sql_query in message payload\")\n",
    "ValueError: No sql_query in message payload\n"
  ]
}
2025-10-11 14:41:51 - ERROR - ВРЕМЯ ВЫПОЛНЕНИЯ ДО ОШИБКИ: 2.36ms
2025-10-11 14:41:51,927 - thermo_agents_session_20251011_144115 - ERROR - ВРЕМЯ ВЫПОЛНЕНИЯ ДО ОШИБКИ: 2.36ms
2025-10-11 14:41:51 - INFO - МАРШРУТ: FROM: sql_agent
2025-10-11 14:41:51,928 - thermo_agents_session_20251011_144115 - INFO - МАРШРУТ: FROM: sql_agent
2025-10-11 14:41:51 - INFO - CORRELATION ID: 746dcb29-c10f-4a22-b54d-066cabad4e37
2025-10-11 14:41:51,928 - thermo_agents_session_20251011_144115 - INFO - CORRELATION ID: 746dcb29-c10f-4a22-b54d-066cabad4e37
2025-10-11 14:41:51 - ERROR - ПОЛНОЕ СОСТОЯНИЕ ХРАНИЛИЩА НА МОМЕНТ ОШИБКИ:
2025-10-11 14:41:51,929 - thermo_agents_session_20251011_144115 - ERROR - ПОЛНОЕ СОСТОЯНИЕ ХРАНИЛИЩА НА МОМЕНТ ОШИБКИ:
2025-10-11 14:41:51 - ERROR - {
  "timestamp": "2025-10-11T14:41:51.921549",
  "stats": {
    "storage_entries": 2,
    "message_queue_size": 0,
    "message_history_size": 4,
    "active_sessions": 6,
    "agents": [
      "thermo_agent",
      "sql_agent",
      "database_agent",
      "results_filtering_agent",
      "individual_search_agent",
      "orchestrator"
    ]
  },
  "storage_entries": {
    "orchestrator_request_1301991133728": {
      "created_at": "2025-10-11T14:41:33.833835",
      "updated_at": "2025-10-11T14:41:33.833835",
      "ttl_seconds": 600,
      "metadata": {},
      "value_type": "dict",
      "value_preview": "{'user_query': 'При какой температуре провзаимодействует оксид кальция и сульфид железа?', 'request_type': 'thermodynamic', 'options': {}}"
    },
    "thermo_result_b4fe6625-0352-4f97-89f0-bce8eae1b61e": {
      "created_at": "2025-10-11T14:41:43.858224",
      "updated_at": "2025-10-11T14:41:43.858224",
      "ttl_seconds": 600,
      "metadata": {},
      "value_type": "dict",
      "value_preview": "{'intent': 'reaction', 'compounds': [], 'temperature_k': 298.15, 'temperature_range_k': [198.14999999999998, 498.15], 'phases': [], 'properties': ['all'], 'sql_query_hint': 'Fallback extraction: При к"
    }
  },
  "message_queue": [],
  "recent_history": [
    {
      "id": "b4fe6625-0352-4f97-89f0-bce8eae1b61e",
      "timestamp": "2025-10-11T14:41:33.833835",
      "source_agent": "orchestrator",
      "target_agent": "thermo_agent",
      "message_type": "extract_parameters",
      "correlation_id": null
    },
    {
      "id": "05819dc1-b37c-4cd9-b54e-00fb583a667c",
      "timestamp": "2025-10-11T14:41:43.859295",
      "source_agent": "thermo_agent",
      "target_agent": "sql_agent",
      "message_type": "generate_query",
      "correlation_id": "b4fe6625-0352-4f97-89f0-bce8eae1b61e"
    },
    {
      "id": "6acb274f-259e-42fb-ba2d-cd2536a14f4f",
      "timestamp": "2025-10-11T14:41:43.858224",
      "source_agent": "thermo_agent",
      "target_agent": "orchestrator",
      "message_type": "response",
      "correlation_id": "b4fe6625-0352-4f97-89f0-bce8eae1b61e"
    },
    {
      "id": "746dcb29-c10f-4a22-b54d-066cabad4e37",
      "timestamp": "2025-10-11T14:41:49.952897",
      "source_agent": "sql_agent",
      "target_agent": "database_agent",
      "message_type": "execute_sql",
      "correlation_id": null
    }
  ],
  "agent_sessions": {
    "thermo_agent": {
      "status": "running",
      "capabilities": [
        "extract_parameters",
        "normalize_formulas",
        "convert_temperature"
      ],
      "metadata": {}
    },
    "sql_agent": {
      "status": "running",
      "capabilities": [
        "generate_sql",
        "execute_query",
        "explain_query"
      ],
      "metadata": {
        "database": "data/thermo_data.db"
      }
    },
    "database_agent": {
      "status": "running",
      "capabilities": [
        "execute_sql",
        "filter_results",
        "query_database"
      ],
      "metadata": {
        "database": "data/thermo_data.db"
      }
    },
    "results_filtering_agent": {
      "status": "running",
      "capabilities": [
        "filter_results",
        "temperature_analysis",
        "compound_selection"
      ],
      "metadata": {}
    },
    "individual_search_agent": {
      "status": "running",
      "capabilities": [
        "coordinate_individual_search",
        "aggregate_results",
        "handle_parallel_searches"
      ],
      "metadata": {}
    },
    "orchestrator": {
      "status": "ready",
      "capabilities": [],
      "metadata": {}
    }
  }
}
2025-10-11 14:41:51,930 - thermo_agents_session_20251011_144115 - ERROR - {
  "timestamp": "2025-10-11T14:41:51.921549",
  "stats": {
    "storage_entries": 2,
    "message_queue_size": 0,
    "message_history_size": 4,
    "active_sessions": 6,
    "agents": [
      "thermo_agent",
      "sql_agent",
      "database_agent",
      "results_filtering_agent",
      "individual_search_agent",
      "orchestrator"
    ]
  },
  "storage_entries": {
    "orchestrator_request_1301991133728": {
      "created_at": "2025-10-11T14:41:33.833835",
      "updated_at": "2025-10-11T14:41:33.833835",
      "ttl_seconds": 600,
      "metadata": {},
      "value_type": "dict",
      "value_preview": "{'user_query': 'При какой температуре провзаимодействует оксид кальция и сульфид железа?', 'request_type': 'thermodynamic', 'options': {}}"
    },
    "thermo_result_b4fe6625-0352-4f97-89f0-bce8eae1b61e": {
      "created_at": "2025-10-11T14:41:43.858224",
      "updated_at": "2025-10-11T14:41:43.858224",
      "ttl_seconds": 600,
      "metadata": {},
      "value_type": "dict",
      "value_preview": "{'intent': 'reaction', 'compounds': [], 'temperature_k': 298.15, 'temperature_range_k': [198.14999999999998, 498.15], 'phases': [], 'properties': ['all'], 'sql_query_hint': 'Fallback extraction: При к"
    }
  },
  "message_queue": [],
  "recent_history": [
    {
      "id": "b4fe6625-0352-4f97-89f0-bce8eae1b61e",
      "timestamp": "2025-10-11T14:41:33.833835",
      "source_agent": "orchestrator",
      "target_agent": "thermo_agent",
      "message_type": "extract_parameters",
      "correlation_id": null
    },
    {
      "id": "05819dc1-b37c-4cd9-b54e-00fb583a667c",
      "timestamp": "2025-10-11T14:41:43.859295",
      "source_agent": "thermo_agent",
      "target_agent": "sql_agent",
      "message_type": "generate_query",
      "correlation_id": "b4fe6625-0352-4f97-89f0-bce8eae1b61e"
    },
    {
      "id": "6acb274f-259e-42fb-ba2d-cd2536a14f4f",
      "timestamp": "2025-10-11T14:41:43.858224",
      "source_agent": "thermo_agent",
      "target_agent": "orchestrator",
      "message_type": "response",
      "correlation_id": "b4fe6625-0352-4f97-89f0-bce8eae1b61e"
    },
    {
      "id": "746dcb29-c10f-4a22-b54d-066cabad4e37",
      "timestamp": "2025-10-11T14:41:49.952897",
      "source_agent": "sql_agent",
      "target_agent": "database_agent",
      "message_type": "execute_sql",
      "correlation_id": null
    }
  ],
  "agent_sessions": {
    "thermo_agent": {
      "status": "running",
      "capabilities": [
        "extract_parameters",
        "normalize_formulas",
        "convert_temperature"
      ],
      "metadata": {}
    },
    "sql_agent": {
      "status": "running",
      "capabilities": [
        "generate_sql",
        "execute_query",
        "explain_query"
      ],
      "metadata": {
        "database": "data/thermo_data.db"
      }
    },
    "database_agent": {
      "status": "running",
      "capabilities": [
        "execute_sql",
        "filter_results",
        "query_database"
      ],
      "metadata": {
        "database": "data/thermo_data.db"
      }
    },
    "results_filtering_agent": {
      "status": "running",
      "capabilities": [
        "filter_results",
        "temperature_analysis",
        "compound_selection"
      ],
      "metadata": {}
    },
    "individual_search_agent": {
      "status": "running",
      "capabilities": [
        "coordinate_individual_search",
        "aggregate_results",
        "handle_parallel_searches"
      ],
      "metadata": {}
    },
    "orchestrator": {
      "status": "ready",
      "capabilities": [],
      "metadata": {}
    }
  }
}
2025-10-11 14:41:51,938 - database_agent - ERROR - Error in database agent loop: 'SessionLogger' object has no attribute 'log_error'
2025-10-11 14:41:58,505 - __main__ - INFO - Stopping agents...
2025-10-11 14:41:58,507 - thermo_agent - INFO - Agent 'thermo_agent' stopped
2025-10-11 14:41:58,507 - sql_agent - INFO - Agent 'sql_agent' stopped
2025-10-11 14:41:58,507 - database_agent - INFO - Agent 'database_agent' stopped
2025-10-11 14:41:58,508 - results_filtering_agent - INFO - Agent 'results_filtering_agent' stopped
2025-10-11 14:41:58,508 - individual_search_agent - INFO - Agent 'individual_search_agent' stopped
2025-10-11 14:41:58,509 - orchestrator - INFO - Shutting down orchestrator
2025-10-11 14:41:58,510 - __main__ - INFO - All agents stopped
2025-10-11 14:41:58 - INFO - SESSION ENDED
2025-10-11 14:41:58,510 - thermo_agents_session_20251011_144115 - INFO - SESSION ENDED
2025-10-11 14:41:58 - WARNING - Operation cancelled: ОПЕРАЦИЯ: [orchestrator] -> PROCESS_REQUEST
2025-10-11 14:41:58,511 - thermo_agents_session_20251011_144115 - WARNING - Operation cancelled: ОПЕРАЦИЯ: [orchestrator] -> PROCESS_REQUEST
2025-10-11 14:41:58 - WARNING - Operation cancelled: ОПЕРАЦИЯ: [sql_agent] -> GENERATE_QUERY [from thermo_agent]
2025-10-11 14:41:58,511 - thermo_agents_session_20251011_144115 - WARNING - Operation cancelled: ОПЕРАЦИЯ: [sql_agent] -> GENERATE_QUERY [from thermo_agent]
