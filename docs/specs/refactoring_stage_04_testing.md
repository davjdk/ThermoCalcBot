# –≠—Ç–∞–ø 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-11-02  
**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —ç—Ç–∞–ø–∞ 3  

---

## –¶–µ–ª—å —ç—Ç–∞–ø–∞

–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

---

## –ú–æ—Ç–∏–≤–∞—Ü–∏—è

–ü–æ—Å–ª–µ —Ç—Ä–µ—Ö —ç—Ç–∞–ø–æ–≤ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ:

1. –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –¥–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Å–≤–µ—Ä–∫–∞ —Å –Ω–æ—É—Ç–±—É–∫–æ–º)
2. –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ

---

## –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

### 1. Unit-—Ç–µ—Å—Ç—ã –¥–ª—è core-–ª–æ–≥–∏–∫–∏

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `tests/unit/core_logic/`

**–§–∞–π–ª—ã:**

```
tests/unit/core_logic/
‚îú‚îÄ‚îÄ test_compound_data_loader.py
‚îú‚îÄ‚îÄ test_phase_transition_detector.py
‚îú‚îÄ‚îÄ test_record_range_builder.py
‚îú‚îÄ‚îÄ test_thermodynamic_engine.py
‚îî‚îÄ‚îÄ test_reaction_engine.py
```

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã:**

#### `test_compound_data_loader.py`

```python
def test_stage1_search_with_name():
    """–¢–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ 1: –ø–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ä–º—É–ª–µ + –∏–º—è."""
    # –î–æ–ª–∂–Ω–æ –Ω–∞–π—Ç–∏ MgO —Å –∏–º–µ–Ω–µ–º "Magnesium oxide"

def test_stage2_fallback_search():
    """–¢–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ 2: fallback –Ω–∞ —Ç–æ–ª—å–∫–æ —Ñ–æ—Ä–º—É–ª—É."""
    # –ï—Å–ª–∏ —Å—Ç–∞–¥–∏—è 1 –Ω–µ –¥–∞–ª–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

def test_no_results_both_stages():
    """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤."""
    # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç–æ–π DataFrame –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ
```

#### `test_phase_transition_detector.py`

```python
def test_melting_boiling_detection():
    """–¢–µ—Å—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–æ—á–µ–∫ –ø–ª–∞–≤–ª–µ–Ω–∏—è –∏ –∫–∏–ø–µ–Ω–∏—è."""
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö H2O: melting=273K, boiling=373K

def test_no_transitions():
    """–¢–µ—Å—Ç –≤–µ—â–µ—Å—Ç–≤–∞ –±–µ–∑ —Ñ–∞–∑–æ–≤—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤."""
    # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å (None, None)

def test_invalid_boiling_point():
    """–¢–µ—Å—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö —Ç–æ—á–µ–∫ –∫–∏–ø–µ–Ω–∏—è."""
    # Boiling < Melting –¥–æ–ª–∂–Ω–æ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
```

#### `test_record_range_builder.py`

```python
def test_strategy1_expected_phase():
    """–¢–µ—Å—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ 1: –∑–∞–ø–∏—Å—å –æ–∂–∏–¥–∞–µ–º–æ–π —Ñ–∞–∑—ã —Å Tmin ‚âà current_T."""

def test_strategy2_dominant_phase():
    """–¢–µ—Å—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ 2: –∑–∞–ø–∏—Å—å —Å >50% –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ñ–∞–∑–µ."""

def test_strategy3_covering_record():
    """–¢–µ—Å—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ 3: –∑–∞–ø–∏—Å—å, –ø–æ–∫—Ä—ã–≤–∞—é—â–∞—è current_T."""

def test_phase_transition_switching():
    """–¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–∑ –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ melting/boiling."""
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ T=melting —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –∂–∏–¥–∫—É—é —Ñ–∞–∑—É

def test_no_phase_skip():
    """–¢–µ—Å—Ç –∑–∞–ø—Ä–µ—Ç–∞ –ø—Ä–æ–ø—É—Å–∫–∞ —Ñ–∞–∑ (s ‚Üí g –±–µ–∑ l)."""
```

#### `test_thermodynamic_engine.py`

```python
def test_cp_calculation():
    """–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ —Ç–µ–ø–ª–æ–µ–º–∫–æ—Å—Ç–∏ Cp(T)."""
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

def test_enthalpy_calculation():
    """–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ —ç–Ω—Ç–∞–ª—å–ø–∏–∏ H(T)."""
    # –°–≤–µ—Ä–∏—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏–∑ –Ω–æ—É—Ç–±—É–∫–∞

def test_entropy_calculation():
    """–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ —ç–Ω—Ç—Ä–æ–ø–∏–∏ S(T)."""

def test_gibbs_energy_calculation():
    """–¢–µ—Å—Ç —Ä–∞—Å—á–µ—Ç–∞ —ç–Ω–µ—Ä–≥–∏–∏ –ì–∏–±–±—Å–∞ G(T)."""

def test_temperature_out_of_range_warning():
    """–¢–µ—Å—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø—Ä–∏ T –≤–Ω–µ [Tmin, Tmax]."""
    # –î–æ–ª–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å warning
```

#### `test_reaction_engine.py`

```python
def test_full_reaction_calculation():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞ —Ä–µ–∞–∫—Ü–∏–∏ Al‚ÇÇO‚ÇÉ + 3C ‚Üí 2Al + 3CO."""
    # –°–≤–µ—Ä–∏—Ç—å —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏–∑ calc_example.ipynb

def test_parse_reaction_equation():
    """–¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ —É—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏."""
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: =, ‚Üí, ->

def test_missing_compound_data():
    """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤–µ—â–µ—Å—Ç–≤–∞."""
    # –î–æ–ª–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å ValueError
```

---

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `tests/integration/`

**–§–∞–π–ª—ã:**

```
tests/integration/
‚îú‚îÄ‚îÄ test_orchestrator_workflow.py
‚îú‚îÄ‚îÄ test_llm_to_calculation_pipeline.py
‚îî‚îÄ‚îÄ test_logging_integration.py
```

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã:**

#### `test_orchestrator_workflow.py`

```python
async def test_full_workflow_al2o3_reaction():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞: –∑–∞–ø—Ä–æ—Å ‚Üí LLM ‚Üí —Ä–∞—Å—á–µ—Ç ‚Üí —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ."""
    query = "–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ª–∏ —Ä–µ–∞–∫—Ü–∏—è –º–µ–∂–¥—É Al‚ÇÇO‚ÇÉ –∏ —É–≥–ª–µ—Ä–æ–¥–æ–º –ø—Ä–∏ 2000 ¬∞C?"
    result = await orchestrator.process_query(query)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏:
    assert "Al‚ÇÇO‚ÇÉ + 3C ‚Üí 2Al + 3CO" in result
    assert "298" in result  # –ù–∞—á–∞–ª–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞
    assert "2500" in result  # –ö–æ–Ω–µ—Ü –¥–∏–∞–ø–∞–∑–æ–Ω–∞
    assert "ŒîH" in result
    assert "ŒîG" in result
```

#### `test_llm_to_calculation_pipeline.py`

```python
async def test_parameter_extraction_to_calculation():
    """–¢–µ—Å—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –æ—Ç LLM –∫ —Ä–∞—Å—á–µ—Ç–Ω–æ–º—É –¥–≤–∏–∂–∫—É."""
    query = "MgO + SO2 ‚Üí MgSO3 –ø—Ä–∏ 900¬∞C"
    
    # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    params = await agent.extract_parameters(query)
    
    # –†–∞—Å—á–µ—Ç —Å —ç—Ç–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    df_result, metadata = reaction_engine.calculate_reaction_with_metadata(
        params, [298, 2500, 100]
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    assert len(df_result) == 23  # 23 —Ç–æ—á–∫–∏
    assert all(col in df_result.columns for col in ['T (K)', 'ŒîH (–î–∂/–º–æ–ª—å)', 'ŒîS (–î–∂/(–º–æ–ª—å¬∑K))', 'ŒîG (–î–∂/–º–æ–ª—å)'])
```

#### `test_logging_integration.py`

```python
def test_session_logging():
    """–¢–µ—Å—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–≥–æ–≤ –≤ —Ñ–∞–π–ª."""
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—á–µ—Ç
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–æ–∑–¥–∞–Ω —Ñ–∞–π–ª session_*.log
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ª–æ–≥–∞
```

---

### 3. Regression-—Ç–µ—Å—Ç—ã

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `tests/regression/`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –°–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–æ–≤–æ–π –ª–æ–≥–∏–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∏–∑ –Ω–æ—É—Ç–±—É–∫–∞

**–§–∞–π–ª—ã:**

```
tests/regression/
‚îú‚îÄ‚îÄ test_notebook_compatibility.py
‚îî‚îÄ‚îÄ reference_data/
    ‚îú‚îÄ‚îÄ al2o3_reaction_reference.csv
    ‚îî‚îÄ‚îÄ mgo_so2_reaction_reference.csv
```

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã:**

```python
def test_al2o3_reaction_matches_notebook():
    """–¢–µ—Å—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å calc_example.ipynb."""
    # –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ CSV
    reference_df = pd.read_csv('tests/regression/reference_data/al2o3_reaction_reference.csv')
    
    # –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞—Å—á–µ—Ç
    calculated_df, _ = reaction_engine.calculate_reaction_with_metadata(...)
    
    # –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (—Å –¥–æ–ø—É—Å—Ç–∏–º–æ–π –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å—é)
    assert_frame_almost_equal(calculated_df, reference_df, rtol=1e-3)
```

**–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:**

```python
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ reference_data –∏–∑ calc_example.ipynb
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ—É—Ç–±—É–∫, —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å df_result –≤ CSV
```

---

### 4. Performance-—Ç–µ—Å—Ç—ã

**–î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:** `tests/performance/`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ä–∞—Å—á–µ—Ç–æ–≤

**–§–∞–π–ª—ã:**

```
tests/performance/
‚îú‚îÄ‚îÄ test_calculation_speed.py
‚îî‚îÄ‚îÄ test_database_query_performance.py
```

**–ö–ª—é—á–µ–≤—ã–µ —Ç–µ—Å—Ç—ã:**

```python
def test_single_reaction_calculation_time():
    """–¢–µ—Å—Ç –≤—Ä–µ–º–µ–Ω–∏ —Ä–∞—Å—á–µ—Ç–∞ –æ–¥–Ω–æ–π —Ä–µ–∞–∫—Ü–∏–∏."""
    import time
    
    start = time.time()
    df_result, _ = reaction_engine.calculate_reaction_with_metadata(...)
    elapsed = time.time() - start
    
    # –î–æ–ª–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –º–µ–Ω–µ–µ —á–µ–º –∑–∞ 5 —Å–µ–∫—É–Ω–¥
    assert elapsed < 5.0

def test_database_search_performance():
    """–¢–µ—Å—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞ –≤ –ë–î."""
    start = time.time()
    df = compound_loader.get_raw_compound_data('SO2', ['Sulfur dioxide'])
    elapsed = time.time() - start
    
    # –î–æ–ª–∂–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è –º–µ–Ω–µ–µ —á–µ–º –∑–∞ 1 —Å–µ–∫—É–Ω–¥—É
    assert elapsed < 1.0
```

---

## –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞ (Code Coverage)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ coverage:

```toml
# pyproject.toml
[tool.pytest.ini_options]
addopts = "--cov=src/thermo_agents --cov-report=html --cov-report=term"
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å coverage:

```powershell
uv run pytest --cov=src/thermo_agents --cov-report=html
```

### –¶–µ–ª–µ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:

- **core_logic/**: ‚â• 90%
- **formatting/**: ‚â• 80%
- **orchestrator.py**: ‚â• 85%

---

## –ü–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ—Å—Ç–æ–≤

```powershell
New-Item -ItemType Directory -Path tests/unit/core_logic
New-Item -ItemType Directory -Path tests/regression/reference_data
```

### –®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `calc_example.ipynb`
2. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ CSV
3. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ `tests/regression/reference_data/`

### –®–∞–≥ 3: –ù–∞–ø–∏—Å–∞—Ç—å unit-—Ç–µ—Å—Ç—ã

–ù–∞—á–∞—Ç—å —Å —Å–∞–º—ã—Ö –ø—Ä–æ—Å—Ç—ã—Ö –º–æ–¥—É–ª–µ–π:

1. `test_phase_transition_detector.py` (–Ω–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π)
2. `test_compound_data_loader.py` (–∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –ë–î)
3. `test_thermodynamic_engine.py`
4. `test_record_range_builder.py`
5. `test_reaction_engine.py` (—Å–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π)

### –®–∞–≥ 4: –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –®–∞–≥ 5: –ù–∞–ø–∏—Å–∞—Ç—å regression-—Ç–µ—Å—Ç—ã

### –®–∞–≥ 6: –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã

```powershell
uv run pytest -v
```

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å coverage

```powershell
uv run pytest --cov=src/thermo_agents --cov-report=html
# –û—Ç–∫—Ä—ã—Ç—å htmlcov/index.html –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
```

### –®–∞–≥ 8: –ö–æ–º–º–∏—Ç

```powershell
git checkout -b refactor/stage-04-testing
git add tests/
git commit -m "test(stage-04): –î–æ–±–∞–≤–ª–µ–Ω—ã unit, integration –∏ regression —Ç–µ—Å—Ç—ã"
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞

### ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:

1. –°–æ–∑–¥–∞–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π `core_logic/`
2. –°–æ–∑–¥–∞–Ω—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è `orchestrator`
3. –°–æ–∑–¥–∞–Ω—ã regression-—Ç–µ—Å—Ç—ã —Å —Å–≤–µ—Ä–∫–æ–π –ø–æ –Ω–æ—É—Ç–±—É–∫—É
4. –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ (`pytest` exit code 0)
5. Code coverage ‚â• 80% –¥–ª—è `core_logic/`
6. –°–æ–∑–¥–∞–Ω—ã —Ä–µ—Ñ–µ—Ä–µ–Ω—Å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ `calc_example.ipynb`

### ‚úÖ –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:

1. Performance-—Ç–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –ø—Ä–∏–µ–º–ª–µ–º—É—é —Å–∫–æ—Ä–æ—Å—Ç—å (< 5 —Å–µ–∫ –Ω–∞ —Ä–∞—Å—á–µ—Ç)
2. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –Ω–∞ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —Å–ª—É—á–∞–∏ (edge cases)
3. –î–æ–±–∞–≤–ª–µ–Ω—ã —Ç–µ—Å—Ç—ã –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

---

## –†–∏—Å–∫–∏ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### ‚ö†Ô∏è –†–∏—Å–∫–∏:

1. **–†–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ —Å –Ω–æ—É—Ç–±—É–∫–æ–º:** –í–æ–∑–º–æ–∂–Ω—ã –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞–∑–ª–∏—á–∏—è –∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–π
2. **–•—Ä—É–ø–∫–∏–µ —Ç–µ—Å—Ç—ã:** –¢–µ—Å—Ç—ã –º–æ–≥—É—Ç –ª–æ–º–∞—Ç—å—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ë–î
3. **–î–æ–ª–≥–∏–µ —Ç–µ—Å—Ç—ã:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å –ë–î –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏

### üõ°Ô∏è –ú–∏—Ç–∏–≥–∞—Ü–∏—è:

1. **–î–æ–ø—É—Å—Ç–∏–º–∞—è –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `rtol=1e-3` –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏ float
2. **Mock –ë–î:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î –∏–ª–∏ –º–æ–∫–∏ –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤
3. **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è:** –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ (`pytest -n auto`)

---

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

**–≠—Ç–∞–ø 5:** –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

---

**–ê–≤—Ç–æ—Ä:** GitHub Copilot  
**–î–∞—Ç–∞:** 2025-11-02  
**–í–µ—Ä—Å–∏—è:** 1.0
