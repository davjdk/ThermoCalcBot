# –≠—Ç–∞–ø 1: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL

**–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 2-3 –¥–Ω—è  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** –ù–µ –Ω–∞—á–∞—Ç  
**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:** –≠—Ç–∞–ø 0

---

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥—É–ª—è –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –ë–î. –ú–æ–¥—É–ª—å –∑–∞–º–µ–Ω—è–µ—Ç SQL Generation Agent –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —á—ë—Ç–∫–∏–º –ø—Ä–∞–≤–∏–ª–∞–º –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –°–æ–∑–¥–∞—Ç—å `sql_builder.py`
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `src/thermo_agents/search/sql_builder.py`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
```python
class SQLBuilder:
    """–î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–µ—â–µ—Å—Ç–≤."""
    
    def build_compound_search_query(
        self, 
        formula: str, 
        temperature_range: Optional[Tuple[float, float]] = None
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SQL –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤–µ—â–µ—Å—Ç–≤–∞ –ø–æ —Ñ–æ—Ä–º—É–ª–µ.
        
        –õ–æ–≥–∏–∫–∞:
        1. –ü–æ–∏—Å–∫ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è: TRIM(Formula) = '{formula}'
        2. –ü–æ–∏—Å–∫ —Å —Ñ–∞–∑–æ–π: Formula LIKE '{formula}(%'
        3. –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ ReliabilityClass ASC
        4. –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: LIMIT 100
        
        Returns:
            SQL-–∑–∞–ø—Ä–æ—Å –≤ –≤–∏–¥–µ —Å—Ç—Ä–æ–∫–∏
        """
        ...
    
    def build_temperature_filter(
        self, 
        tmin_user: float, 
        tmax_user: float
    ) -> str:
        """
        –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É—Å–ª–æ–≤–∏–µ WHERE –¥–ª—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
        
        –õ–æ–≥–∏–∫–∞:
        - –ü–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ [Tmin, Tmax] —Å [tmin_user, tmax_user]
        - –û–±—Ä–∞–±–æ—Ç–∫–∞ NULL –∑–Ω–∞—á–µ–Ω–∏–π –≤ Tmin/Tmax
        
        Returns:
            SQL WHERE clause
        """
        ...
```

---

### 2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–∏—Å–∫ –ø–æ —Ñ–æ—Ä–º—É–ª–µ —Å —É—á—ë—Ç–æ–º –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏—è

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–∏—Å–∫–∞ (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≠—Ç–∞–ø–∞ 0):**

**–í–∞—Ä–∏–∞–Ω—Ç 1: –¢–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ**
```sql
SELECT * FROM compounds 
WHERE TRIM(Formula) = 'H2O'
ORDER BY ReliabilityClass ASC
LIMIT 100;
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–∏—Å–∫ —Å —Ñ–∞–∑–æ–π –≤ —Å–∫–æ–±–∫–∞—Ö**
```sql
SELECT * FROM compounds 
WHERE Formula LIKE 'H2O(%'
ORDER BY ReliabilityClass ASC
LIMIT 100;
```

**–í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å**
```sql
SELECT * FROM compounds 
WHERE TRIM(Formula) = 'H2O' 
   OR Formula LIKE 'H2O(%'
ORDER BY ReliabilityClass ASC
LIMIT 100;
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_build_formula_condition(formula: str) -> str`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ SQL
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ñ–æ—Ä–º—É–ª–∞—Ö: H2O, TiO2, Fe+3, NaCl(aq)

---

### 3. –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (–Ω–∞ –æ—Å–Ω–æ–≤–µ –≠—Ç–∞–ø–∞ 0):**

1. **ReliabilityClass** (1 > 2 > 3 > 4)
2. **–ü–æ–ª–Ω–æ—Ç–∞ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö** (H298, S298, f1-f6 –Ω–µ NULL)
3. **–ù–∞–ª–∏—á–∏–µ —Ñ–∞–∑–æ–≤—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤** (Tmelt, Tboil –∑–∞–ø–æ–ª–Ω–µ–Ω—ã)

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```sql
ORDER BY 
    ReliabilityClass ASC,
    (CASE WHEN H298 IS NOT NULL AND S298 IS NOT NULL THEN 0 ELSE 1 END),
    (CASE WHEN Tmelt IS NOT NULL OR Tboil IS NOT NULL THEN 0 ELSE 1 END)
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `_build_order_clause() -> str`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ (–∫–ª–∞—Å—Å `FilterPriorities`)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤—ã–±–æ—Ä–∫–µ –∏–∑ 100+ –∑–∞–ø–∏—Å–µ–π

---

### 4. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö –∏–∑ –≠—Ç–∞–ø–∞ 0

**–¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏:**

**TC1: –í–æ–¥–∞ (H2O) –ø—Ä–∏ 298-673K**
```python
query = sql_builder.build_compound_search_query('H2O', (298, 673))
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –∑–∞–ø—Ä–æ—Å —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ
# –†–µ–∑—É–ª—å—Ç–∞—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å H2O(l), H2O(g)
```

**TC2: –û–∫—Å–∏–¥ —Ç–∏—Ç–∞–Ω–∞ (TiO2) –ø—Ä–∏ 600-900K**
```python
query = sql_builder.build_compound_search_query('TiO2', (600, 900))
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –∑–∞–ø—Ä–æ—Å –¥–ª—è —Ç–≤—ë—Ä–¥–æ–π —Ñ–∞–∑—ã
```

**TC3: –ñ–µ–ª–µ–∑–æ (Fe) —Å —Ñ–∞–∑–æ–≤—ã–º –ø–µ—Ä–µ—Ö–æ–¥–æ–º –ø—Ä–∏ 1500-2000K**
```python
query = sql_builder.build_compound_search_query('Fe', (1500, 2000))
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –∑–∞–ø—Ä–æ—Å, –ø–æ–∫—Ä—ã–≤–∞—é—â–∏–π s‚Üíl –ø–µ—Ä–µ—Ö–æ–¥ –ø—Ä–∏ 1811K
```

**TC4: –ö–∏—Å–ª–æ—Ä–æ–¥ (O2) –≤ —à–∏—Ä–æ–∫–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ**
```python
query = sql_builder.build_compound_search_query('O2', (298, 2000))
# –û–∂–∏–¥–∞–µ—Ç—Å—è: –∑–∞–ø—Ä–æ—Å –¥–ª—è –≥–∞–∑–æ–≤–æ–π —Ñ–∞–∑—ã
```

**–ó–∞–¥–∞—á–∏:**
- [ ] –°–æ–∑–¥–∞—Ç—å `tests/test_sql_builder.py` —Å unit-—Ç–µ—Å—Ç–∞–º–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å SQL-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è–º

---

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã —ç—Ç–∞–ø–∞

### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
1. `src/thermo_agents/search/sql_builder.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
2. `src/thermo_agents/search/__init__.py` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç—ã
3. `tests/test_sql_builder.py` ‚Äî —Ç–µ—Å—Ç—ã

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Python
- `typing` –¥–ª—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π —Ç–∏–ø–æ–≤
- `sqlite3` –∏–ª–∏ `sqlalchemy` –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î (—É–∂–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ –ø—Ä–æ–µ–∫—Ç–µ)

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç—Ç–∞–ø–∞

‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
1. –ú–æ–¥—É–ª—å `sql_builder.py` —Å–æ–∑–¥–∞–Ω –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SQL
2. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ñ–æ—Ä–º—É–ª (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ + —Ñ–∞–∑–∞)
3. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º (ReliabilityClass, –ø–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö)
4. –í—Å–µ 4 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª—É—á–∞—è –ø—Ä–æ—Ö–æ–¥—è—Ç —É—Å–ø–µ—à–Ω–æ
5. Unit-—Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç >80% –∫–æ–¥–∞ –º–æ–¥—É–ª—è
6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î –ø—Ä–æ—Ö–æ–¥—è—Ç

üìã **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ:**
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ docstrings –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ `examples/sql_builder_demo.py`

---

## –†–∏—Å–∫–∏

| –†–∏—Å–∫                                  | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –í–ª–∏—è–Ω–∏–µ | –ú–∏—Ç–∏–≥–∞—Ü–∏—è                                             |
| ------------------------------------- | ----------- | ------- | ----------------------------------------------------- |
| SQL-–∏–Ω—ä–µ–∫—Ü–∏–∏ —á–µ—Ä–µ–∑ —Ñ–æ—Ä–º—É–ª—ã            | –°—Ä–µ–¥–Ω—è—è     | –í—ã—Å–æ–∫–æ–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã |
| –ù–µ–ø–æ–ª–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ñ–æ—Ä–º—É–ª    | –°—Ä–µ–¥–Ω—è—è     | –°—Ä–µ–¥–Ω–µ–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≠—Ç–∞–ø–∞ 0, –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã       |
| –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö | –ù–∏–∑–∫–∞—è      | –°—Ä–µ–¥–Ω–µ–µ | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã, LIMIT 100                       |

---

## –°–ª–µ–¥—É—é—â–∏–π —ç—Ç–∞–ø

‚û°Ô∏è **–≠—Ç–∞–ø 2:** –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –º–æ–¥—É–ª—è –ø–æ–∏—Å–∫–∞
