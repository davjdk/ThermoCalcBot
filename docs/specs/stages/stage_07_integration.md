# Stage 07: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ end-to-end —Ç–µ—Å—Ç—ã (Big Bang)

## –¶–µ–ª—å
–í—ã–ø–æ–ª–Ω–∏—Ç—å –æ–¥–Ω–æ–º–æ–º–µ–Ω—Ç–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏–∑ Stage 01-06 –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ —Å–∏—Å—Ç–µ–º—ã, –∑–∞–º–µ–Ω–∏–≤ —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É —Ä–∞—Å—á—ë—Ç–æ–≤ –Ω–æ–≤–æ–π –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π.

## –°—Ç–∞—Ç—É—Å
üü¢ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ

## –°—Ç—Ä–∞—Ç–µ–≥–∏—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è
**Big Bang (–æ–¥–Ω–æ–º–æ–º–µ–Ω—Ç–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ)** ‚Äî –ø–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏ –Ω–∞ –Ω–æ–≤—É—é –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—É—é —Å–∏—Å—Ç–µ–º—É –±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ñ–ª–∞–≥–æ–≤.

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
- ‚úÖ –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞ (—Å—Ç–∞—Ä–∞—è + –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)
- ‚úÖ –ß–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±–µ–∑ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –¥–æ–ª–≥–∞
- ‚úÖ –ë—ã—Å—Ç—Ä–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ (–Ω–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏)
- ‚úÖ –£–ø—Ä–æ—â—ë–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–æ–¥–∏–Ω –ø—É—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

### –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è
- ‚ö†Ô∏è **–†–∏—Å–∫:** –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –±–∞–≥–∞—Ö
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –ë–î –∏ –∫–æ–¥–∞ –ø–µ—Ä–µ–¥ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** Git-–≤–µ—Ç–∫–∞ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é revert
  
- ‚ö†Ô∏è **–†–∏—Å–∫:** –†–µ–≥—Ä–µ—Å—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä regression-—Ç–µ—Å—Ç–æ–≤
  - **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–π vs –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

## –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- ‚úÖ Stage 01: `CompoundSearcher.search_all_phases()` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- ‚úÖ Stage 02: `TemperatureSegment` –∏ `PhaseTransition` –≥–æ—Ç–æ–≤—ã
- ‚úÖ Stage 03: `MultiPhaseProperties` –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Stage 04: `StaticDataManager` –∏ YAML –∫—ç—à
- ‚úÖ Stage 05: `ThermodynamicCalculator.calculate_multi_phase_properties()` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Stage 06: –§–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã –¥–ª—è –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞

## –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `ThermodynamicAgent` (—Ç–æ–ª—å–∫–æ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞)
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π `Orchestrator` —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- End-to-end —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–£–¥–∞–ª—ë–Ω–Ω—ã–π** —Å—Ç–∞—Ä—ã–π –∫–æ–¥ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤

## –ò–∑–º–µ–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã
- `src/thermo_agents/thermodynamic_agent.py` ‚úèÔ∏è –ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –ª–æ–≥–∏–∫–∏
- `src/thermo_agents/orchestrator.py` ‚úèÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- `src/thermo_agents/operations.py` ‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–π
- –í—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ ‚ùå –£–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∞–¥–∏–∏ (01-06) **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à–µ–Ω—ã**

## –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ–π—Å—Ç–≤–∏–π (Big Bang Strategy)

### –®–∞–≥ 1: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤

**–§–∞–π–ª:** `src/thermo_agents/thermodynamic_agent.py`

#### ‚ùå –£–¥–∞–ª–∏—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é:
1. **–ú–µ—Ç–æ–¥ `_calculate_single_phase()`** ‚Äî —Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
   ```python
   def _calculate_single_phase(self, formula: str, T_min: float, T_max: float, 
                                step_k: int, compound_names: Optional[List[str]]) -> str:
       # –í—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–¥–∞–ª—è–µ—Ç—Å—è
   ```

2. **–ú–µ—Ç–æ–¥ `_needs_multi_phase_calculation()`** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞, –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π)
   ```python
   def _needs_multi_phase_calculation(self, formula: str, T_max: float, 
                                      compound_names: Optional[List[str]] = None) -> bool:
       # –í—Å—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —É–¥–∞–ª—è–µ—Ç—Å—è
   ```

3. **–ü–∞—Ä–∞–º–µ—Ç—Ä `use_multi_phase`** –∏–∑ `__init__()` ‚Äî –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω —Ñ–ª–∞–≥ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
   ```python
   def __init__(self, ..., use_multi_phase: bool = True):  # ‚Üê –£–¥–∞–ª–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
       self.use_multi_phase = use_multi_phase  # ‚Üê –£–¥–∞–ª–∏—Ç—å –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ
   ```

4. **–£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞** –≤ `calculate_compound_properties()`:
   ```python
   # ‚ùå –£–î–ê–õ–ò–¢–¨:
   needs_multi_phase = self._needs_multi_phase_calculation(...)
   if needs_multi_phase and self.use_multi_phase:
       return self._calculate_multi_phase(...)
   else:
       return self._calculate_single_phase(...)
   ```

#### ‚úèÔ∏è –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞:
```python
def calculate_compound_properties(
    self,
    formula: str,
    T_min: float,
    T_max: float,
    step_k: int = 100,
    compound_names: Optional[List[str]] = None
) -> str:
    """
    –†–∞—Å—á—ë—Ç —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤ –≤–µ—â–µ—Å—Ç–≤–∞ (–º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π).
    """
    self.logger.info(f"–ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è {formula}, T_range=({T_min}, {T_max})K")
    
    # –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Ñ–∞–∑ (–≤—Å–µ–≥–¥–∞ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥)
    search_result = self.compound_searcher.search_all_phases(
        formula=formula,
        max_temperature=T_max,
        compound_names=compound_names
    )
    
    if not search_result.records:
        return f"‚ùå –í–µ—â–µ—Å—Ç–≤–æ {formula} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ë–î"
    
    # –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç
    mp_result = self.calculator.calculate_multi_phase_properties(
        records=search_result.records,
        T_target=T_max
    )
    
    # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
    # ... (—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ _calculate_multi_phase)
```

---

### –®–∞–≥ 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ Orchestrator —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π StaticDataManager

**–§–∞–π–ª:** `src/thermo_agents/orchestrator.py`

#### ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å `__init__()`:

**–ë—ã–ª–æ (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è):**
```python
def __init__(self, db_path: str):
    self.db_connector = DatabaseConnector(db_path)
    self.sql_builder = SQLBuilder()
    self.compound_searcher = CompoundSearcher(
        sql_builder=self.sql_builder,
        db_connector=self.db_connector
        # ‚Üê –ù–µ—Ç StaticDataManager
    )
    self.calculator = ThermodynamicCalculator()
    # ‚Üê –ù–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
```

**–°—Ç–∞–ª–æ (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):**
```python
def __init__(
    self,
    db_path: str,
    static_cache_dir: str = "data/static_compounds/",
    integration_points: int = 400
):
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π."""
    self.logger = logging.getLogger(f"{__name__}.{self.__class__.__name__}")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è StaticDataManager
    self.static_data_manager = StaticDataManager(
        data_dir=Path(static_cache_dir)
    )
    self.logger.info(f"‚úÖ StaticDataManager: {static_cache_dir}")
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å –Ω–æ–≤—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
    self.db_connector = DatabaseConnector(db_path)
    self.sql_builder = SQLBuilder()
    
    # CompoundSearcher —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π YAML –∫—ç—à–∞
    self.compound_searcher = CompoundSearcher(
        sql_builder=self.sql_builder,
        db_connector=self.db_connector,
        static_data_manager=self.static_data_manager  # ‚Üê –ù–æ–≤–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
    )
    
    # ThermodynamicCalculator —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
    self.calculator = ThermodynamicCalculator(
        num_integration_points=integration_points
    )
    
    # Formatter –∏ Agent
    self.formatter = ReactionCalculationFormatter()
    self.agent = ThermodynamicAgent(
        compound_searcher=self.compound_searcher,
        calculator=self.calculator,
        formatter=self.formatter
        # ‚Üê –ë–æ–ª—å—à–µ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ use_multi_phase
    )
```

#### ‚ùå –£–¥–∞–ª–∏—Ç—å (–µ—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç):
- –õ—é–±—ã–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è `use_multi_phase=False` –∏–ª–∏ —É—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
- –°—Ç–∞—Ä—ã–µ –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è `CompoundSearcher` –±–µ–∑ `StaticDataManager`

---

### –®–∞–≥ 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–§–∞–π–ª:** `src/thermo_agents/orchestrator.py` (–≤ –Ω–∞—á–∞–ª–µ —Ñ–∞–π–ª–∞)

#### ‚ûï –î–æ–±–∞–≤–∏—Ç—å:
```python
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
MULTI_PHASE_CONFIG = {
    "use_static_cache": True,  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å YAML –∫—ç—à
    "static_cache_dir": "data/static_compounds/",
    "min_segments_for_warning": 5,  # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—Ç—å –µ—Å–ª–∏ > 5 —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    "integration_points": 400,  # –¢–æ—á–µ–∫ –¥–ª—è —á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
    "max_temperature": 6000.0,  # –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ —Ä–∞—Å—á—ë—Ç–∞ (K)
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```python
# –í __init__():
static_cache_dir: str = MULTI_PHASE_CONFIG["static_cache_dir"],
integration_points: int = MULTI_PHASE_CONFIG["integration_points"]
```

---

### –®–∞–≥ 4: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

**–§–∞–π–ª—ã:** 
- `src/thermo_agents/thermodynamic_agent.py`
- `src/thermo_agents/search/compound_searcher.py`
- `src/thermo_agents/calculations/thermodynamic_calculator.py`

#### ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ª–æ–≥–∏:

**–í `CompoundSearcher.search_all_phases()`:**
```python
if self.static_data_manager:
    cached_data = self.static_data_manager.get_compound(formula)
    if cached_data:
        self.logger.info(f"‚ö° –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω YAML –∫—ç—à –¥–ª—è {formula}")
        return self._convert_cached_to_search_result(cached_data)
```

**–í `ThermodynamicCalculator.calculate_multi_phase_properties()`:**
```python
self.logger.info(
    f"–ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç: {len(segments)} —Å–µ–≥–º–µ–Ω—Ç–æ–≤, "
    f"{len(phase_transitions)} –ø–µ—Ä–µ—Ö–æ–¥–æ–≤"
)

for transition in phase_transitions:
    self.logger.info(
        f"–§–∞–∑–æ–≤—ã–π –ø–µ—Ä–µ—Ö–æ–¥: {transition.from_phase}‚Üí{transition.to_phase} "
        f"–ø—Ä–∏ {transition.temperature}K"
    )
```

**–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ –ø—Ä–æ–±–µ–ª–æ–≤ –≤ –ø–æ–∫—Ä—ã—Ç–∏–∏:**
```python
if gap_detected:
    self.logger.warning(
        f"‚ö†Ô∏è –ü—Ä–æ–±–µ–ª –≤ –ø–æ–∫—Ä—ã—Ç–∏–∏: {T_end_prev}K - {T_start_next}K "
        f"–¥–ª—è {formula}"
    )
```

---

### –®–∞–≥ 5: –£–¥–∞–ª–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤

**–î–µ–π—Å—Ç–≤–∏—è:**

#### ‚ùå –£–¥–∞–ª–∏—Ç—å —Ç–µ—Å—Ç—ã, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏:
1. `tests/test_thermodynamic_agent.py` ‚Äî –µ—Å–ª–∏ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω–æ—á–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã
2. –õ—é–±—ã–µ —Ç–µ—Å—Ç—ã —Å `use_multi_phase=False`
3. –¢–µ—Å—Ç—ã –º–µ—Ç–æ–¥–∞ `_calculate_single_phase()`

#### ‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–µ—Å—Ç—ã:
```python
# –ë—ã–ª–æ:
def test_single_phase_calculation():
    agent = ThermodynamicAgent(..., use_multi_phase=False)
    result = agent.calculate_compound_properties("O2", 298, 500, 100)
    # ...

# –°—Ç–∞–ª–æ:
def test_o2_multi_phase_calculation():
    agent = ThermodynamicAgent(...)  # ‚Üê –ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ use_multi_phase
    result = agent.calculate_compound_properties("O2", 298, 500, 100)
    # –ü—Ä–æ–≤–µ—Ä–∫–∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    assert "[–°–µ–≥–º–µ–Ω—Ç" in result or "O2" in result
```

#### ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ regression-—Ç–µ—Å—Ç—ã:
```python
# tests/regression/test_old_queries_with_new_code.py
def test_simple_query_works_as_before():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π."""
    orchestrator = Orchestrator(db_path="test.db")
    result = orchestrator.process_query("–†–∞—Å—Å—á–∏—Ç–∞–π O2 –ø—Ä–∏ 500K")
    
    # –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç (—Ö–æ—Ç—è —Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è)
    assert "O2" in result
    assert "500" in result
```

---

### –®–∞–≥ 6: End-to-end —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–ù–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:**

#### ‚ûï –°–æ–∑–¥–∞—Ç—å:
1. **`tests/integration/test_h2o_full_pipeline.py`** ‚Äî H2O —á–µ—Ä–µ–∑ s‚Üíl‚Üíg —Ñ–∞–∑—ã
2. **`tests/integration/test_feo_multi_phase.py`** ‚Äî FeO –ø—Ä–∏ 1700K (5 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏–∑ –¢–ó)
3. **`tests/integration/test_cao_sio2_reaction.py`** ‚Äî –†–µ–∞–∫—Ü–∏—è —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
4. **`tests/integration/test_yaml_cache_priority.py`** ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç YAML ‚Üí –ë–î
5. **`tests/integration/test_all_phase_transitions.py`** ‚Äî –í—Å–µ —Ç–∏–ø—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ (s‚Üíl, l‚Üíg, s‚Üíg)

**–°—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã—Ç–∏—è:**
- ‚úÖ –†–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ 1 —Ñ–∞–∑—É (–ø—Ä–æ—Å—Ç–æ–π —Å–ª—É—á–∞–π)
- ‚úÖ –†–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ 2 —Ñ–∞–∑—ã (s‚Üíl –∏–ª–∏ l‚Üíg)
- ‚úÖ –†–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ 3 —Ñ–∞–∑—ã (s‚Üíl‚Üíg)
- ‚úÖ –†–∞—Å—á—ë—Ç —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –≤ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –†–∞—Å—á—ë—Ç —Å –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—â–∏–º–∏—Å—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏
- ‚úÖ YAML –∫—ç—à vs –ë–î
- ‚úÖ –†–µ–∞–∫—Ü–∏–∏ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–µ—â–µ—Å—Ç–≤–∞–º–∏

---

### –®–∞–≥ 7: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ operations.py

**–§–∞–π–ª:** `src/thermo_agents/operations.py`

#### ‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ `ThermodynamicAgent`:

**–ë—ã–ª–æ:**
```python
def calculate_compound_data(formula: str, T_min: float, T_max: float, 
                           step_k: int = 100, use_multi_phase: bool = True):
    agent = ThermodynamicAgent(..., use_multi_phase=use_multi_phase)
    # ...
```

**–°—Ç–∞–ª–æ:**
```python
def calculate_compound_data(formula: str, T_min: float, T_max: float, 
                           step_k: int = 100):
    # ‚Üê –£–¥–∞–ª—ë–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä use_multi_phase
    agent = ThermodynamicAgent(...)  # ‚Üê –ù–µ—Ç —Ñ–ª–∞–≥–∞, –≤—Å–µ–≥–¥–∞ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π
    # ...
```

#### ‚ùå –£–¥–∞–ª–∏—Ç—å:
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `use_multi_phase` –∏–∑ —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ—É–Ω–∫—Ü–∏–π
- –£—Å–ª–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º –ø–æ–¥—Ö–æ–¥–æ–º

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (Big Bang)

### –ö–æ–¥
- [ ] **–£–¥–∞–ª—ë–Ω** —Å—Ç–∞—Ä—ã–π –º–µ—Ç–æ–¥ `_calculate_single_phase()` –∏–∑ `ThermodynamicAgent`
- [ ] **–£–¥–∞–ª—ë–Ω** –º–µ—Ç–æ–¥ `_needs_multi_phase_calculation()` –∏–∑ `ThermodynamicAgent`
- [ ] **–£–¥–∞–ª—ë–Ω** –ø–∞—Ä–∞–º–µ—Ç—Ä `use_multi_phase` –∏–∑ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] **–£–¥–∞–ª–µ–Ω–∞** —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É –æ–¥–∏–Ω–æ—á–Ω—ã–º –∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–º —Ä–∞—Å—á—ë—Ç–æ–º
- [ ] `ThermodynamicAgent` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Ç–æ–ª—å–∫–æ** –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—É—é –ª–æ–≥–∏–∫—É
- [ ] `Orchestrator` –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç `StaticDataManager` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- [ ] `CompoundSearcher` –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç `search_all_phases()`
- [ ] –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `MULTI_PHASE_CONFIG` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–µ–∑–¥–µ

### –¢–µ—Å—Ç—ã
- [ ] **–£–¥–∞–ª–µ–Ω—ã/–æ–±–Ω–æ–≤–ª–µ–Ω—ã** –≤—Å–µ —Ç–µ—Å—Ç—ã —Å–æ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–æ–π
- [ ] End-to-end —Ç–µ—Å—Ç—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (‚â•95%)
- [ ] Regression-—Ç–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Performance-—Ç–µ—Å—Ç—ã: —Ç–∏–ø–æ–≤–æ–π –∑–∞–ø—Ä–æ—Å < 500ms
- [ ] –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (H2O, FeO, CaO+SiO2)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (—É–¥–∞–ª–µ–Ω—ã —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ñ–ª–∞–≥–æ–≤)
- [ ] README.md –æ–±–Ω–æ–≤–ª—ë–Ω —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
- [ ] –ü—Ä–∏–º–µ—Ä—ã –≤ `examples/` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–¥ –Ω–æ–≤—ã–π API

### –ö–∞—á–µ—Å—Ç–≤–æ
- [ ] –ù–µ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–π: –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞–ª–∞ (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline)
- [ ] –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ ‚â• 95% –¥–ª—è –∏–∑–º–µ–Ω—ë–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- [ ] Code review –ø—Ä–æ–π–¥–µ–Ω
- [ ] Git-–≤–µ—Ç–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ merge –≤ main

## –¢–µ—Å—Ç—ã (Big Bang Strategy)

### Unit-—Ç–µ—Å—Ç—ã (–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ)
- `tests/test_thermodynamic_agent_multiphase.py` ‚Äî **—Ç–æ–ª—å–∫–æ** –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞
- `tests/test_orchestrator_multiphase.py` ‚Äî —Ç–µ—Å—Ç—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –±–µ–∑ —Ñ–ª–∞–≥–æ–≤

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (–Ω–æ–≤—ã–µ)
- `tests/integration/test_h2o_full_pipeline.py` ‚Äî H2O —á–µ—Ä–µ–∑ s‚Üíl‚Üíg
- `tests/integration/test_feo_multi_phase.py` ‚Äî FeO –ø—Ä–∏ 1700K (–∏–∑ –¢–ó)
- `tests/integration/test_cao_sio2_reaction.py` ‚Äî –†–µ–∞–∫—Ü–∏—è —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏
- `tests/integration/test_yaml_cache_priority.py` ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç YAML ‚Üí –ë–î
- `tests/integration/test_all_phase_transitions.py` ‚Äî –í—Å–µ —Ç–∏–ø—ã –ø–µ—Ä–µ—Ö–æ–¥–æ–≤

### Performance-—Ç–µ—Å—Ç—ã
- `tests/performance/test_multi_phase_speed.py` ‚Äî –°–∫–æ—Ä–æ—Å—Ç—å –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞
- `tests/performance/test_yaml_cache_impact.py` ‚Äî –í–ª–∏—è–Ω–∏–µ YAML –∫—ç—à–∞ –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### Regression-—Ç–µ—Å—Ç—ã (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã)
- `tests/regression/test_old_queries_work.py` ‚Äî –°—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π
- `tests/regression/test_output_format_compatibility.py` ‚Äî –§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º
- `tests/regression/test_calculation_accuracy.py` ‚Äî –¢–æ—á–Ω–æ—Å—Ç—å —Ä–∞—Å—á—ë—Ç–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å

### –£–¥–∞–ª—è–µ–º—ã–µ —Ç–µ—Å—Ç—ã
- ‚ùå `tests/test_single_phase_*.py` ‚Äî —Ç–µ—Å—Ç—ã —Å—Ç–∞—Ä–æ–π –æ–¥–∏–Ω–æ—á–Ω–æ–π –ª–æ–≥–∏–∫–∏
- ‚ùå –õ—é–±—ã–µ —Ç–µ—Å—Ç—ã —Å `use_multi_phase=False`
- ‚ùå –¢–µ—Å—Ç—ã –º–µ—Ç–æ–¥–æ–≤ `_calculate_single_phase()` –∏ `_needs_multi_phase_calculation()`

## –†–∏—Å–∫–∏ (Big Bang Strategy)

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ä–∏—Å–∫–∏
- **–ü–æ–ª–Ω–∞—è –∑–∞–º–µ–Ω–∞ –ª–æ–≥–∏–∫–∏**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±—ã—Å—Ç—Ä–æ–≥–æ –æ—Ç–∫–∞—Ç–∞ –±–µ–∑ revert –∫–æ–º–º–∏—Ç–∞
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑–Ω—É—é –≤–µ—Ç–∫—É `release/v2-single-phase` –ø–µ—Ä–µ–¥ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –¢—â–∞—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ dev-–æ–∫—Ä—É–∂–µ–Ω–∏–∏ –º–∏–Ω–∏–º—É–º 3 –¥–Ω—è
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ì–æ—Ç–æ–≤—ã–π –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (rollback) —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏
  
- **–†–µ–≥—Ä–µ—Å—Å–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–≥—É—Ç —Å–ª–æ–º–∞—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä regression-—Ç–µ—Å—Ç–æ–≤ (‚â•50 —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: —Å—Ç–∞—Ä–∞—è vs –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ –ø–µ—Ä–µ–¥ merge

### üü† –í—ã—Å–æ–∫–∏–µ —Ä–∏—Å–∫–∏
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–µ —Ä–∞—Å—á—ë—Ç—ã –º–æ–≥—É—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: YAML –∫—ç—à –¥–ª—è 50+ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `cProfile` –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: Benchmark-—Ç–µ—Å—Ç—ã: –Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ >30% —Å—Ç–∞—Ä–æ–π
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

- **–ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–≤–æ–¥–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –≥–æ—Ç–æ–≤—ã –∫ –Ω–æ–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∞
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: FAQ —Å –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã

### üü° –°—Ä–µ–¥–Ω–∏–µ —Ä–∏—Å–∫–∏
- **–°–ª–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ª–∞–¥–∫–∏**: –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–ª–æ–∂–Ω–µ–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –ø—Ä–æ–±–ª–µ–º
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ (DEBUG —É—Ä–æ–≤–µ–Ω—å)
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å–µ–≥–º–µ–Ω—Ç–∞
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ

- **–ù–µ–ø–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –ë–î**: –ú–æ–≥—É—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å—Å—è –ø—Ä–æ–±–µ–ª—ã –≤ –¥–∞–Ω–Ω—ã—Ö
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ YAML –∫—ç—à–∞ –¥–ª—è –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: Fallback –Ω–∞ –æ–¥–∏–Ω–æ—á–Ω—É—é –∑–∞–ø–∏—Å—å –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–µ–ª–∞—Ö

### üü¢ –ù–∏–∑–∫–∏–µ —Ä–∏—Å–∫–∏
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –í–∞–ª–∏–¥–∞—Ü–∏—è `MULTI_PHASE_CONFIG` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
  - *–ú–∏—Ç–∏–≥–∞—Ü–∏—è*: –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ–º

---

## –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ (Rollback Plan)

–í —Å–ª—É—á–∞–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è:

### –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç (< 10 –º–∏–Ω—É—Ç)
```bash
# 1. –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
git revert <commit-hash-of-big-bang-merge>
git push origin main

# 2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –≤–µ—Ç–∫—É
git checkout release/v2-single-phase
git push origin release/v2-single-phase --force-with-lease

# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
# (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–µ–ø–ª–æ—è)
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å 10 —Ç–∏–ø–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è –≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –æ—Ç–∫–∞—Ç–µ

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

### –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞ Big Bang

**–ü–æ—á–µ–º—É –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å –æ—Ç Feature Flag (–ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è)?**

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–≤—É—Ö –ª–æ–≥–∏–∫ (—Å—Ç–∞—Ä–æ–π + –Ω–æ–≤–æ–π) —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥
2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**: –ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ–±–∞ –ø—É—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —á–∏—Å—Ç–æ—Ç–∞**: –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π –ø–æ–¥—Ö–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã –∏–∑ –¢–ó
4. **–í—Å–µ —Å—Ç–∞–¥–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã**: Stage 01-06 –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**–£—Å–ª–æ–≤–∏—è –¥–ª—è Big Bang:**
- ‚úÖ –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∞–¥–∏–∏ (01-06) –∑–∞–≤–µ—Ä—à–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ï—Å—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä regression-—Ç–µ—Å—Ç–æ–≤
- ‚úÖ –í–æ–∑–º–æ–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π –æ—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ Git
- ‚úÖ –ö–æ–º–∞–Ω–¥–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–º—É —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é

---

### –ü–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (Big Bang)

**–î–µ–Ω—å 0: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞**
- –°–æ–∑–¥–∞—Ç—å —Ä–µ–ª–∏–∑–Ω—É—é –≤–µ—Ç–∫—É `release/v2-single-phase` (—Ç–æ—á–∫–∞ –æ—Ç–∫–∞—Ç–∞)
- –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä —Ç–µ—Å—Ç–æ–≤ –Ω–∞ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ (baseline)
- –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

**–î–µ–Ω—å 1: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ –∫–æ–¥–∞**
- ‚úèÔ∏è –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—É—é –ª–æ–≥–∏–∫—É –∏–∑ `ThermodynamicAgent`
- ‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å `Orchestrator` —Å `StaticDataManager`
- ‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å `operations.py`
- ‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `MULTI_PHASE_CONFIG`
- ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ unit-—Ç–µ—Å—Ç—ã

**–î–µ–Ω—å 2-3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (H2O, FeO, CaO+SiO2)
- üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å regression-—Ç–µ—Å—Ç—ã (—Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
- üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å performance-—Ç–µ—Å—Ç—ã (—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline)
- üêõ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –±–∞–≥–∏
- üìä –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**–î–µ–Ω—å 4: –§–∏–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏**
- ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (‚â•95% –ø–æ–∫—Ä—ã—Ç–∏–µ)
- ‚úÖ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞ (–Ω–µ —Ö—É–∂–µ +30% –æ—Ç baseline)
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- ‚úÖ Code review –ø—Ä–æ–π–¥–µ–Ω
- ‚úÖ –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω

**–î–µ–Ω—å 5: –î–µ–ø–ª–æ–π**
- üöÄ Merge –≤ `main`
- üöÄ –î–µ–ø–ª–æ–π –Ω–∞ production
- üëÄ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫ (–≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞, –æ—à–∏–±–∫–∏)
- üì¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–± –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–î–µ–Ω—å 6-7: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
- üìä –ê–Ω–∞–ª–∏–∑ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- üêõ –ì–æ—Ä—è—á–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (hotfixes) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- üìù –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ lessons learned
- üéâ –£—Å–ø–µ—Ö –∏–ª–∏ –æ—Ç–∫–∞—Ç (–µ—Å–ª–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã)

---

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏:**
1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
   - –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ (p50, p95, p99)
   - –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å baseline —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏
   - –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ > 1 —Å–µ–∫—É–Ω–¥–∞

2. **–ö–∞—á–µ—Å—Ç–≤–æ:**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫ —Ä–∞—Å—á—ë—Ç–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)
   - –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ‚â•99%)
   - –ü—Ä–æ—Ü–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è YAML –∫—ç—à–∞

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
   - –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
   - –¢–∏–ø—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–ê–ª–µ—Ä—Ç—ã:**
- üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π: –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ p95 > 2 —Å–µ–∫—É–Ω–¥—ã
- üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π: –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ > 5%
- üü† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ p95 > 1 —Å–µ–∫—É–Ω–¥–∞
- üü† –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫ > 1%
- üü° –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –ü—Ä–æ–±–µ–ª—ã –≤ –ø–æ–∫—Ä—ã—Ç–∏–∏ –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤

**–î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∞–ª–µ—Ä—Ç–∞—Ö:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–µ—Ä—Ç ‚Üí —Ä–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç–∫–∞—Ç
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚Üí –∞–Ω–∞–ª–∏–∑ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Üí –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ backlog

---

### –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ —ç—Ç–∞–ø–∞–º–∏

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π:**
- **Stage 01** ‚Üí `CompoundSearcher.search_all_phases()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- **Stage 02** ‚Üí `TemperatureSegment` –∏ `PhaseTransition` –≤ –ª–æ–≥–∏–∫–µ —Ä–∞—Å—á—ë—Ç–æ–≤
- **Stage 03** ‚Üí `MultiPhaseProperties` –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- **Stage 04** ‚Üí `StaticDataManager` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ `Orchestrator`
- **Stage 05** ‚Üí `ThermodynamicCalculator.calculate_multi_phase_properties()` –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥
- **Stage 06** ‚Üí –§–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã –¥–ª—è –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ `ThermodynamicAgent`

**–£–¥–∞–ª—è–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:**
- ‚ùå –°—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞ –æ–¥–∏–Ω–æ—á–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤
- ‚ùå –ú–µ—Ç–æ–¥—ã `_calculate_single_phase()`, `_needs_multi_phase_calculation()`
- ‚ùå –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `use_multi_phase` –≤–µ–∑–¥–µ
- ‚ùå –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞
- ‚ùå –¢–µ—Å—Ç—ã –¥–ª—è —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏

---

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞ (Big Bang - —Ç–æ–ª—å–∫–æ –Ω–æ–≤–∞—è –ª–æ–≥–∏–∫–∞)

### –ü—Ä–∏–º–µ—Ä 1: –ù–æ–≤—ã–π ThermodynamicAgent (–ë–ï–ó —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏)

```python
# src/thermo_agents/thermodynamic_agent.py
# ‚ùå –£–î–ê–õ–ï–ù–û: use_multi_phase, _needs_multi_phase_calculation, _calculate_single_phase

from typing import Optional, List
import logging
from .search.compound_searcher import CompoundSearcher
from .calculations.thermodynamic_calculator import ThermodynamicCalculator
from .formatting.reaction_calculation_formatter import ReactionCalculationFormatter

class ThermodynamicAgent:
    """–ê–≥–µ–Ω—Ç –¥–ª—è –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤."""
    
    def __init__(
        self,
        compound_searcher: CompoundSearcher,
        calculator: ThermodynamicCalculator,
        formatter: ReactionCalculationFormatter
        # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase: bool = True
    ):
        self.compound_searcher = compound_searcher
        self.calculator = calculator
        self.formatter = formatter
        self.logger = logging.getLogger(f"{__name__}.{self.__class__.__name__}")
    
    def calculate_compound_properties(
        self,
        formula: str,
        T_min: float,
        T_max: float,
        step_k: int = 100,
        compound_names: Optional[List[str]] = None
    ) -> str:
        """
        –†–∞—Å—á—ë—Ç —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤ –≤–µ—â–µ—Å—Ç–≤–∞ (–¢–û–õ–¨–ö–û –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π).
        
        ‚ùå –£–î–ê–õ–ï–ù–û: –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ –º–µ–∂–¥—É –æ–¥–∏–Ω–æ—á–Ω—ã–º –∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–º
        ‚úÖ –í–°–ï–ì–î–ê: –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç —á–µ—Ä–µ–∑ search_all_phases()
        """
        self.logger.info(f"–ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è {formula}, T_range=({T_min}, {T_max})K")
        
        # ‚úÖ –ü–æ–∏—Å–∫ –≤—Å–µ—Ö —Ñ–∞–∑ (–í–°–ï–ì–î–ê)
        search_result = self.compound_searcher.search_all_phases(
            formula=formula,
            max_temperature=T_max,
            compound_names=compound_names
        )
        
        if not search_result.records:
            return f"‚ùå –í–µ—â–µ—Å—Ç–≤–æ {formula} –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –ë–î"
        
        self.logger.info(
            f"–ù–∞–π–¥–µ–Ω–æ {len(search_result.records)} –∑–∞–ø–∏—Å–µ–π, "
            f"{search_result.phase_count} —Ñ–∞–∑"
        )
        
        # ‚úÖ –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç
        mp_result = self.calculator.calculate_multi_phase_properties(
            records=search_result.records,
            T_target=T_max
        )
        
        # ‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
        output = self.formatter.format_compound_data_multi_phase(
            formula=formula,
            compound_name=search_result.records[0].name or formula,
            multi_phase_result=mp_result
        )
        
        # –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Ç–æ—á–µ–∫ —Ñ–∞–∑–æ–≤—ã—Ö –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
        temperatures = list(range(int(T_min), int(T_max) + 1, step_k))
        
        for transition in mp_result.phase_transitions:
            if T_min <= transition.temperature <= T_max:
                if transition.temperature not in temperatures:
                    temperatures.append(transition.temperature)
        
        temperatures = sorted(temperatures)
        
        # –†–∞—Å—á—ë—Ç –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        table_data = []
        for T in temperatures:
            mp_T = self.calculator.calculate_multi_phase_properties(
                records=search_result.records,
                T_target=T
            )
            table_data.append({
                "T": T,
                "H": mp_T.H_final / 1000,  # –∫–î–∂/–º–æ–ª—å
                "S": mp_T.S_final,
                "G": mp_T.G_final / 1000,
                "Cp": mp_T.Cp_final
            })
        
        table_output = self.formatter.format_properties_table(table_data)
        
        return f"{output}\n\n{table_output}"
    
    # ‚ùå –£–î–ê–õ–ï–ù–´ –ú–ï–¢–û–î–´:
    # - _needs_multi_phase_calculation() 
    # - _calculate_multi_phase() (–ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–∞ –≤ calculate_compound_properties)
    # - _calculate_single_phase()
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–æ–≤—ã–π Orchestrator (–ë–ï–ó —Ñ–ª–∞–≥–æ–≤)

```python
# src/thermo_agents/orchestrator.py
# ‚ùå –£–î–ê–õ–ï–ù–û: use_multi_phase –ø–∞—Ä–∞–º–µ—Ç—Ä –∏ —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞

import logging
from pathlib import Path
from .thermodynamic_agent import ThermodynamicAgent
from .search.compound_searcher import CompoundSearcher
from .search.database_connector import DatabaseConnector
from .search.sql_builder import SQLBuilder
from .calculations.thermodynamic_calculator import ThermodynamicCalculator
from .formatting.reaction_calculation_formatter import ReactionCalculationFormatter
from .storage.static_data_manager import StaticDataManager

# ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ (–í–°–ï–ì–î–ê –≤–∫–ª—é—á–µ–Ω–æ)
MULTI_PHASE_CONFIG = {
    "use_static_cache": True,
    "static_cache_dir": "data/static_compounds/",
    "min_segments_for_warning": 5,
    "integration_points": 400,
    "max_temperature": 6000.0,
}

class Orchestrator:
    """–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Ä–∞—Å—á—ë—Ç–æ–≤ (–¢–û–õ–¨–ö–û –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–µ)."""
    
    def __init__(
        self,
        db_path: str,
        static_cache_dir: str = None,
        integration_points: int = None
        # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase: Optional[bool] = None
    ):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
        
        Args:
            db_path: –ü—É—Ç—å –∫ –ë–î
            static_cache_dir: –ü—É—Ç—å –∫ YAML –∫—ç—à—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
            integration_points: –¢–æ—á–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∏—è (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞)
        """
        self.logger = logging.getLogger(f"{__name__}.{self.__class__.__name__}")
        
        # ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (–±–µ–∑ —Ñ–ª–∞–≥–∞ use_multi_phase)
        self.static_cache_dir = (
            static_cache_dir or MULTI_PHASE_CONFIG["static_cache_dir"]
        )
        self.integration_points = (
            integration_points or MULTI_PHASE_CONFIG["integration_points"]
        )
        
        self.logger.info(
            f"–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (–º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–µ–∂–∏–º): "
            f"static_cache={self.static_cache_dir}, "
            f"integration_points={self.integration_points}"
        )
        
        # ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        self.db_connector = DatabaseConnector(db_path)
        self.sql_builder = SQLBuilder()
        
        # ‚úÖ StaticDataManager (–í–°–ï–ì–î–ê –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è)
        try:
            self.static_data_manager = StaticDataManager(
                data_dir=Path(self.static_cache_dir)
            )
            self.logger.info("‚úÖ StaticDataManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
        except Exception as e:
            self.logger.warning(f"‚ö†Ô∏è StaticDataManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: {e}")
            self.static_data_manager = None
        
        # ‚úÖ CompoundSearcher —Å StaticDataManager
        self.compound_searcher = CompoundSearcher(
            sql_builder=self.sql_builder,
            db_connector=self.db_connector,
            static_data_manager=self.static_data_manager
        )
        
        # ‚úÖ ThermodynamicCalculator —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π
        self.calculator = ThermodynamicCalculator(
            num_integration_points=self.integration_points
        )
        
        # ‚úÖ Formatter
        self.formatter = ReactionCalculationFormatter()
        
        # ‚úÖ ThermodynamicAgent (–ë–ï–ó –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ use_multi_phase)
        self.agent = ThermodynamicAgent(
            compound_searcher=self.compound_searcher,
            calculator=self.calculator,
            formatter=self.formatter
            # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase=self.use_multi_phase
        )
    
    def process_query(self, user_query: str) -> str:
        """
        –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–¢–û–õ–¨–ö–û –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç).
        
        Args:
            user_query: –ó–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            
        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç
        """
        self.logger.info(f"‚ö° –ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞: {user_query}")
        
        # –°—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        # ... (–±–µ–∑ —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ use_multi_phase)
        
        return response

# ‚ùå –£–î–ê–õ–ï–ù–û:
# - –ü–∞—Ä–∞–º–µ—Ç—Ä use_multi_phase –∏–∑ __init__
# - –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ self.use_multi_phase
# - –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ if self.use_multi_phase
# - –ü–µ—Ä–µ–¥–∞—á–∞ use_multi_phase –≤ ThermodynamicAgent
```

---

### –ü—Ä–∏–º–µ—Ä 3: –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π operations.py

```python
# src/thermo_agents/operations.py
# ‚ùå –£–î–ê–õ–ï–ù–´: –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã use_multi_phase

from typing import Optional, List
from .orchestrator import Orchestrator

def calculate_compound_data(
    formula: str, 
    T_min: float, 
    T_max: float, 
    step_k: int = 100,
    compound_names: Optional[List[str]] = None
    # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase: bool = True
) -> str:
    """
    –†–∞—Å—á—ë—Ç —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö —Å–≤–æ–π—Å—Ç–≤ –≤–µ—â–µ—Å—Ç–≤–∞.
    
    –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç.
    """
    orchestrator = Orchestrator(db_path="data/thermo.db")
    # ‚ùå –£–î–ê–õ–ï–ù–û: –ø–µ—Ä–µ–¥–∞—á–∞ use_multi_phase
    
    return orchestrator.agent.calculate_compound_properties(
        formula=formula,
        T_min=T_min,
        T_max=T_max,
        step_k=step_k,
        compound_names=compound_names
    )

def calculate_reaction(
    reaction_str: str,
    T_min: float,
    T_max: float,
    step_k: int = 100
    # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase: bool = True
) -> str:
    """
    –†–∞—Å—á—ë—Ç —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∏ —Ä–µ–∞–∫—Ü–∏–∏.
    
    –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è –≤—Å–µ—Ö –≤–µ—â–µ—Å—Ç–≤.
    """
    orchestrator = Orchestrator(db_path="data/thermo.db")
    # ‚ùå –£–î–ê–õ–ï–ù–û: –ø–µ—Ä–µ–¥–∞—á–∞ use_multi_phase
    
    # –ü–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∞–∫—Ü–∏–∏ –∏ —Ä–∞—Å—á—ë—Ç
    # ... (–±–µ–∑ —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏ use_multi_phase)
    
    return result
```

---

### –ü—Ä–∏–º–µ—Ä 4: End-to-end —Ç–µ—Å—Ç (Big Bang)

```python
# tests/integration/test_multi_phase_end_to_end.py

import pytest
from src.thermo_agents.orchestrator import Orchestrator

@pytest.fixture
def orchestrator(tmp_path):
    """–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º –∫—ç—à–µ–º."""
    test_db_path = "tests/fixtures/test_thermo.db"
    
    return Orchestrator(
        db_path=test_db_path,
        # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase=True (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω)
        static_cache_dir=str(tmp_path / "static_compounds")
    )

def test_feo_1700k_end_to_end(orchestrator):
    """End-to-end —Ç–µ—Å—Ç —Ä–∞—Å—á—ë—Ç–∞ FeO –ø—Ä–∏ 1700K (–ø—Ä–∏–º–µ—Ä –∏–∑ –¢–ó)."""
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–≤–æ–π—Å—Ç–≤–∞ FeO –æ—Ç 298K –¥–æ 1700K"
    
    response = orchestrator.process_query(query)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
    assert "FeO" in response
    assert "[–°–µ–≥–º–µ–Ω—Ç" in response  # ‚úÖ –í–°–ï–ì–î–ê –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    assert "–§–ê–ó–û–í–´–ô –ü–ï–†–ï–•–û–î" in response
    assert "s ‚Üí l" in response
    assert "1650" in response  # Tmelt
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    assert response.count("[–°–µ–≥–º–µ–Ω—Ç") >= 3

def test_h2o_phase_transitions_end_to_end(orchestrator):
    """End-to-end —Ç–µ—Å—Ç H2O —á–µ—Ä–µ–∑ —Ñ–∞–∑–æ–≤—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã."""
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π —Å–≤–æ–π—Å—Ç–≤–∞ H2O –æ—Ç 200K –¥–æ 500K"
    
    response = orchestrator.process_query(query)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    assert "H2O" in response or "Water" in response
    assert "273" in response or "Tmelt" in response  # –ü–ª–∞–≤–ª–µ–Ω–∏–µ
    assert "373" in response or "Tboil" in response  # –ö–∏–ø–µ–Ω–∏–µ

def test_reaction_cao_sio2_end_to_end(orchestrator):
    """End-to-end —Ç–µ—Å—Ç —Ä–µ–∞–∫—Ü–∏–∏ CaO + SiO2 ‚Üí CaSiO3."""
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π —Ä–µ–∞–∫—Ü–∏—é CaO + SiO2 = CaSiO3 –æ—Ç 298K –¥–æ 1773K"
    
    response = orchestrator.process_query(query)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∏
    assert "CaO" in response
    assert "SiO2" in response
    assert "CaSiO3" in response
    assert "–î–∞–Ω–Ω—ã–µ –≤–µ—â–µ—Å—Ç–≤:" in response
    assert "–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á—ë—Ç–∞:" in response

def test_yaml_cache_priority(tmp_path):
    """–¢–µ—Å—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ YAML –∫—ç—à–∞ –Ω–∞–¥ –ë–î."""
    # –°–æ–∑–¥–∞—Ç—å YAML —Ñ–∞–π–ª –¥–ª—è H2O
    yaml_content = """
compound:
  formula: "H2O"
  common_names: ["Water"]
  description: "Test Water"
  phases:
    - phase: "g"
      tmin: 298.0
      tmax: 1000.0
      h298: -241826.0
      s298: 188.83
      f1: 33.066
      f2: 2.563
      f3: 0.0
      f4: 0.0
      f5: 0.0
      f6: 0.0
      tmelt: 273.15
      tboil: 373.15
      reliability_class: 1
  metadata:
    source_database: "test.db"
    extracted_date: "2025-10-19"
    version: "1.0"
"""
    
    cache_dir = tmp_path / "static_compounds"
    cache_dir.mkdir(parents=True, exist_ok=True)
    (cache_dir / "H2O.yaml").write_text(yaml_content)
    
    # –°–æ–∑–¥–∞—Ç—å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä —Å –∫—ç—à–µ–º
    orch = Orchestrator(
        db_path="tests/fixtures/test_thermo.db",
        static_cache_dir=str(cache_dir)
    )
    
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π H2O –ø—Ä–∏ 500K"
    response = orch.process_query(query)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è YAML –∫—ç—à–∞
    assert "H2O" in response
    assert "Test Water" in response or "Water" in response

# ‚ùå –£–î–ê–õ–Å–ù: test_backward_compatibility —Å use_multi_phase=False
# –¢–µ–ø–µ—Ä—å –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫–ª—é—á–∏—Ç—å –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–µ–∂–∏–º
```

---

### –ü—Ä–∏–º–µ—Ä 5: Regression-—Ç–µ—Å—Ç (–∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)

```python
# tests/regression/test_old_queries_work.py
# –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π

import pytest
from src.thermo_agents.orchestrator import Orchestrator

# –°–ø–∏—Å–æ–∫ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å
OLD_QUERIES = [
    "–†–∞—Å—Å—á–∏—Ç–∞–π O2 –ø—Ä–∏ 500K",
    "–î–∞–Ω–Ω—ã–µ –ø–æ N2 –æ—Ç 298K –¥–æ 1000K",
    "–†–µ–∞–∫—Ü–∏—è 2H2 + O2 = 2H2O –ø—Ä–∏ 1000K",
    "–ü–æ–∫–∞–∂–∏ —Å–≤–æ–π—Å—Ç–≤–∞ CO2",
]

@pytest.mark.parametrize("query", OLD_QUERIES)
def test_old_query_works_with_multiphase(query):
    """
    Regression-—Ç–µ—Å—Ç: —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.
    
    ‚ùå –£–î–ê–õ–ï–ù–û: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å use_multi_phase=False
    ‚úÖ –í–°–ï–ì–î–ê: –¢–æ–ª—å–∫–æ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–µ–∂–∏–º
    """
    orchestrator = Orchestrator(
        db_path="tests/fixtures/test_thermo.db"
        # ‚ùå –£–î–ê–õ–Å–ù: use_multi_phase=True/False
    )
    
    try:
        response = orchestrator.process_query(query)
        
        # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
        assert len(response) > 50, "–û—Ç–≤–µ—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π"
        assert "‚ùå" not in response, "–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫—É"
        
        # ‚úÖ –ù–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —Ñ–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–º
        # –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ, —Ç–∞–∫ –∫–∞–∫ –º—ã –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç
        
    except Exception as e:
        pytest.fail(f"–ó–∞–ø—Ä–æ—Å '{query}' –≤—ã–∑–≤–∞–ª –æ—à–∏–±–∫—É: {e}")

def test_simple_query_format_change():
    """
    –¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–≤–æ–¥–∞.
    
    –°—Ç–∞—Ä—ã–µ –ø—Ä–æ—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ç–µ–ø–µ—Ä—å –º–æ–≥—É—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.
    –≠—Ç–æ –û–ñ–ò–î–ê–ï–ú–û–ï –ò–ó–ú–ï–ù–ï–ù–ò–ï –ø–æ—Å–ª–µ Big Bang.
    """
    orchestrator = Orchestrator(db_path="tests/fixtures/test_thermo.db")
    
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π H2O –æ—Ç 298K –¥–æ 500K"
    response = orchestrator.process_query(query)
    
    # –§–æ—Ä–º–∞—Ç –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å "[–°–µ–≥–º–µ–Ω—Ç" (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
    assert "H2O" in response or "Water" in response
    assert "298" in response or "500" in response
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ —Ñ–æ—Ä–º–∞—Ç–∞
    # (—Ñ–æ—Ä–º–∞—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è, –Ω–æ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏)

# ‚ùå –£–î–ê–õ–Å–ù: test_old_format_with_flag_disabled()
# –ë–æ–ª—å—à–µ –Ω–µ—Ç —Ñ–ª–∞–≥–∞ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
```

---

### –ü—Ä–∏–º–µ—Ä 6: –¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```python
# tests/performance/test_multi_phase_performance.py

import pytest
import time
from src.thermo_agents.orchestrator import Orchestrator

def test_multi_phase_query_performance():
    """–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞."""
    orchestrator = Orchestrator(db_path="tests/fixtures/test_thermo.db")
    
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π FeO –æ—Ç 298K –¥–æ 1700K —Å —à–∞–≥–æ–º 100K"
    
    start = time.time()
    response = orchestrator.process_query(query)
    elapsed = time.time() - start
    
    # –¢–∏–ø–æ–≤–æ–π –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –∑–∞–Ω—è—Ç—å < 500ms
    assert elapsed < 0.5, f"–ó–∞–ø—Ä–æ—Å –∑–∞–Ω—è–ª {elapsed*1000:.1f}ms (–æ–∂–∏–¥–∞–ª–æ—Å—å < 500ms)"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
    assert "FeO" in response
    assert len(response) > 100

@pytest.mark.parametrize("formula,max_T,expected_time", [
    ("H2O", 500, 0.3),
    ("FeO", 1700, 0.5),
    ("SiO2", 1500, 0.4),
    ("CO2", 1000, 0.3),
])
def test_performance_by_compound(formula, max_T, expected_time):
    """–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–µ—â–µ—Å—Ç–≤."""
    orchestrator = Orchestrator(db_path="tests/fixtures/test_thermo.db")
    
    query = f"–†–∞—Å—Å—á–∏—Ç–∞–π {formula} –æ—Ç 298K –¥–æ {max_T}K"
    
    start = time.time()
    response = orchestrator.process_query(query)
    elapsed = time.time() - start
    
    assert elapsed < expected_time, (
        f"{formula}: {elapsed*1000:.1f}ms > {expected_time*1000:.0f}ms"
    )
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏
    assert formula in response

def test_yaml_cache_performance_boost(tmp_path):
    """–¢–µ—Å—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ—Ç YAML –∫—ç—à–∞."""
    # –°–æ–∑–¥–∞—Ç—å YAML —Ñ–∞–π–ª –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
    yaml_content = """
compound:
  formula: "H2O"
  common_names: ["Water"]
  phases:
    - phase: "g"
      tmin: 298.0
      tmax: 1000.0
      h298: -241826.0
      s298: 188.83
      f1: 33.066
      f2: 2.563
      f3: 0.0
      f4: 0.0
      f5: 0.0
      f6: 0.0
  metadata:
    source_database: "test.db"
"""
    
    cache_dir = tmp_path / "static_compounds"
    cache_dir.mkdir(parents=True, exist_ok=True)
    (cache_dir / "H2O.yaml").write_text(yaml_content)
    
    # –° –∫—ç—à–µ–º
    orch_with_cache = Orchestrator(
        db_path="tests/fixtures/test_thermo.db",
        static_cache_dir=str(cache_dir)
    )
    
    # –ë–µ–∑ –∫—ç—à–∞ (–ø—É—Å—Ç–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è)
    empty_cache = tmp_path / "empty_cache"
    empty_cache.mkdir()
    orch_no_cache = Orchestrator(
        db_path="tests/fixtures/test_thermo.db",
        static_cache_dir=str(empty_cache)
    )
    
    query = "–†–∞—Å—Å—á–∏—Ç–∞–π H2O –ø—Ä–∏ 500K"
    
    # –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Å –∫—ç—à–µ–º
    start = time.time()
    orch_with_cache.process_query(query)
    time_with_cache = time.time() - start
    
    # –ò–∑–º–µ—Ä–µ–Ω–∏–µ –±–µ–∑ –∫—ç—à–∞
    start = time.time()
    orch_no_cache.process_query(query)
    time_no_cache = time.time() - start
    
    # YAML –∫—ç—à –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±—ã—Å—Ç—Ä–µ–µ (–∏–ª–∏ —Ö–æ—Ç—è –±—ã –Ω–µ –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
    assert time_with_cache <= time_no_cache * 1.2, (
        f"YAML –∫—ç—à –º–µ–¥–ª–µ–Ω–Ω–µ–µ: {time_with_cache:.3f}s vs {time_no_cache:.3f}s"
    )
```

---

## –†–µ–∑—é–º–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞ (Big Bang)

### ‚ùå –ß—Ç–æ –£–î–ê–õ–Ø–ï–¢–°–Ø –ø–æ–ª–Ω–æ—Å—Ç—å—é:

**–í `ThermodynamicAgent`:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `use_multi_phase: bool` –∏–∑ `__init__()`
- –ú–µ—Ç–æ–¥ `_needs_multi_phase_calculation()`
- –ú–µ—Ç–æ–¥ `_calculate_single_phase()`
- –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ `if needs_multi_phase and self.use_multi_phase:`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–∏–Ω–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞"

**–í `Orchestrator`:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `use_multi_phase` –∏–∑ `__init__()`
- –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ `self.use_multi_phase`
- –£—Å–ª–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è `if MULTI_PHASE_CONFIG["use_static_cache"]:`
- –ü–µ—Ä–µ–¥–∞—á–∞ `use_multi_phase` –≤ `ThermodynamicAgent`
- –ö–ª—é—á `"enabled"` –∏–∑ `MULTI_PHASE_CONFIG`

**–í `operations.py`:**
- –ü–∞—Ä–∞–º–µ—Ç—Ä `use_multi_phase` –∏–∑ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- –£—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤—ã–±–æ—Ä–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á—ë—Ç–∞

**–í —Ç–µ—Å—Ç–∞—Ö:**
- –í—Å–µ —Ç–µ—Å—Ç—ã —Å `use_multi_phase=False`
- –ú–µ—Ç–æ–¥ `test_backward_compatibility()` —Å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ–º —Ñ–ª–∞–≥–∞
- –¢–µ—Å—Ç—ã –º–µ—Ç–æ–¥–æ–≤ `_calculate_single_phase()` –∏ `_needs_multi_phase_calculation()`
- –§–∞–π–ª—ã `tests/test_single_phase_*.py`

### ‚úÖ –ß—Ç–æ –û–°–¢–ê–Å–¢–°–Ø/–î–û–ë–ê–í–õ–Ø–ï–¢–°–Ø:

**–í `ThermodynamicAgent`:**
- –¢–æ–ª—å–∫–æ –º–µ—Ç–æ–¥ `calculate_compound_properties()` —Å –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω–æ–π –ª–æ–≥–∏–∫–æ–π
- –í—Å–µ–≥–¥–∞ –≤—ã–∑–æ–≤ `search_all_phases()` –≤–º–µ—Å—Ç–æ `search_compound()`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ "–ú–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ä–∞—Å—á—ë—Ç –¥–ª—è {formula}"

**–í `Orchestrator`:**
- StaticDataManager –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤—Å–µ–≥–¥–∞
- CompoundSearcher –≤—Å–µ–≥–¥–∞ –ø–æ–ª—É—á–∞–µ—Ç StaticDataManager
- ThermodynamicCalculator —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π integration_points
- –£–ø—Ä–æ—â—ë–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑ —É—Å–ª–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏

**–í —Ç–µ—Å—Ç–∞—Ö:**
- Regression-—Ç–µ—Å—Ç—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –º–Ω–æ–≥–æ—Ñ–∞–∑–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
- Performance-—Ç–µ—Å—Ç—ã —Å—Ä–∞–≤–Ω–∏–≤–∞—é—Ç —Å baseline
- End-to-end —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- –¢–µ—Å—Ç—ã YAML –∫—ç—à–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤
