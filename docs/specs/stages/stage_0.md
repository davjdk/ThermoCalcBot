# Этап 0: Комплексное исследование базы данных

**Длительность:** 3-5 дней  
**Приоритет:** Критический  
**Статус:** Не начат  
**Зависимости:** Нет

---

## Описание

**КРИТИЧЕСКИ ВАЖНЫЙ ЭТАП** — без него невозможна разработка корректной стратегии фильтрации.

Комплексное исследование базы данных `compounds` для понимания структуры данных, паттернов заполнения полей и разработки обоснованной стратегии поиска и фильтрации.

---

## Задачи исследования

### 1. Анализ структуры данных
**Цель:** Понять схему и качество данных

- [ ] Изучить схему таблицы `compounds` (все 32 поля)
- [ ] Проанализировать распределение NULL значений по полям
- [ ] Определить паттерны заполнения температурных диапазонов (Tmin, Tmax)
- [ ] Изучить распределение по `ReliabilityClass` (1-4)

**Инструменты:** SQL-запросы для статистики, подсчёт NULL значений

---

### 2. Анализ химических формул
**Цель:** Понять вариативность записи веществ

- [ ] Паттерны записи формул: чистые (H2O), с фазами (H2O(g)), ионные (Fe+3)
- [ ] Вариативность написания одного вещества (H2O, H2O(l), H2O(aq))
- [ ] Дубликаты и их семантика (разные температурные диапазоны, разные источники)

**Примеры для анализа:**
- `H2O` vs `H2O(l)` vs `H2O(g)` vs `H2O(aq)`
- `Fe` vs `Fe+2` vs `Fe+3`
- `TiO2` vs `TiO2(rutile)` vs `TiO2(anatase)`

---

### 3. Температурные характеристики
**Цель:** Понять покрытие температурных диапазонов

- [ ] Распределение температурных диапазонов [Tmin, Tmax]
- [ ] Частота записей с NULL в Tmin/Tmax и их интерпретация
- [ ] Анализ покрытия диапазонов для типичных веществ (H2O, O2, Fe, TiO2, NaCl)
- [ ] Корреляция температурных диапазонов с фазовыми переходами (Tmelt, Tboil)

**Вопросы для ответа:**
- Если Tmin = NULL, что это означает? (0K? 298K? без ограничений?)
- Если Tmax = NULL, что это означает? (∞? максимальная стабильность?)
- Как часто встречаются пробелы в покрытии диапазонов?

---

### 4. Фазовые состояния
**Цель:** Понять логику фазовых переходов

- [ ] Распределение по фазам: s, l, g, aq
- [ ] Как фаза закодирована (в Formula или отдельное поле Phase)
- [ ] Наличие данных для фазовых переходов (Tmelt, Tboil, Tsublim)
- [ ] % записей с заполненными Tmelt/Tboil

**Примеры для проверки:**
- H2O: твёрдая (273K), жидкая (273-373K), газ (>373K)
- Fe: твёрдое (<1811K), жидкое (>1811K)
- NaCl: твёрдое (<1074K), жидкое (>1074K), водный раствор (aq)

---

### 5. Термодинамические свойства
**Цель:** Оценить полноту данных

- [ ] Полнота заполнения: H298, S298, коэффициенты f1-f6
- [ ] Паттерны отсутствия данных (какие свойства часто NULL)
- [ ] Альтернативные представления (H0, G0, Cp298)

**Статистика для сбора:**
- % записей с заполненным H298
- % записей с заполненным S298
- % записей с полным набором f1-f6
- Корреляция между ReliabilityClass и полнотой данных

---

### 6. Тестовые запросы
**Цель:** Проверить реальные сценарии поиска

- [ ] **H2O:** вода в разных фазах при 298-673K
  - Ожидается: твёрдая (если <273K), жидкая (273-373K), газ (>373K)
  
- [ ] **TiO2 + 2HCl → TiCl4 + H2O:** хлорирование оксида титана при 600-900K
  - Проверить наличие всех 4 веществ в диапазоне
  
- [ ] **Fe:** железо с фазовыми переходами (s→l при 1811K)
  - Проверить переход твёрдое/жидкое
  
- [ ] **O2:** кислород (g) в широком диапазоне
  - Стабильность газовой фазы
  
- [ ] **NaCl:** соль (s→l при 1074K, есть aq форма)
  - Проверить наличие всех фазовых вариантов

---

## Результаты этапа

### 1. Отчёт об исследовании
**Файл:** `docs/database_analysis_report.md`

**Содержание:**
- Статистика по каждому типу анализа
- Выявленные проблемы и ограничения БД
- Рекомендации по стратегии поиска и фильтрации

**Структура отчёта:**
```markdown
# Отчёт об исследовании базы данных

## Общая статистика
- Всего записей: X
- Уникальных формул: Y
- Распределение по ReliabilityClass: ...

## Анализ химических формул
- Паттерны написания
- Примеры дубликатов
- Рекомендации по поиску

## Температурные диапазоны
- Статистика NULL значений
- Примеры покрытия
- Рекомендации по фильтрации

## Фазовые состояния
- Распределение фаз
- Полнота данных Tmelt/Tboil
- Логика определения фазы

## Термодинамические свойства
- Полнота заполнения полей
- Корреляции с ReliabilityClass
- Рекомендации по приоритизации
```

---

### 2. Обоснованная стратегия фильтрации

**Должна включать:**
- Приоритеты полей для поиска
- Логика обработки NULL значений
- Алгоритм выбора между дубликатами
- Правила покрытия температурных диапазонов
- Логика определения фазы при заданной температуре

**Пример:**
```python
# Стратегия поиска по формуле
1. Поиск точного совпадения: TRIM(Formula) = 'H2O'
2. Поиск с фазой в скобках: Formula LIKE 'H2O(%'
3. Сортировка по ReliabilityClass ASC
4. Фильтрация по температурному диапазону
5. Выбор фазы с учётом Tmelt/Tboil
```

---

### 3. Jupyter Notebook для прототипирования
**Файл:** `docs/filtering_strategy_prototype.ipynb`

**Содержание:**
- Прототип каждой стадии фильтрации
- Тестирование на реальных примерах
- Метрики качества фильтрации

**Ячейки:**
1. Подключение к БД
2. Стадия 1: Поиск по формуле (примеры)
3. Стадия 2: Температурная фильтрация (примеры)
4. Стадия 3: Фазовая фильтрация (примеры)
5. Стадия 4: Приоритизация (примеры)
6. Метрики: точность, полнота, покрытие

---

## Критерии завершения этапа

✅ **Обязательные:**
1. Отчёт `database_analysis_report.md` создан и содержит всю статистику
2. Стратегия фильтрации документирована и обоснована
3. Jupyter Notebook содержит работающие прототипы всех стадий
4. Все тестовые запросы выполнены и результаты задокументированы
5. Команда/заказчик утвердили стратегию фильтрации

⚠️ **Без выполнения этих критериев переход к Этапу 1 ЗАПРЕЩЁН**

---

## Риски

| Риск                                | Вероятность | Влияние     | Митигация                                          |
| ----------------------------------- | ----------- | ----------- | -------------------------------------------------- |
| Недостаточное время на исследование | Средняя     | Критическое | Выделить полные 5 дней, не спешить                 |
| Неполное понимание данных           | Высокая     | Критическое | Проверить все примеры, задать вопросы владельцу БД |
| Сложные паттерны данных             | Средняя     | Высокое     | Итеративный подход, прототипирование в Jupyter     |

---

## Следующий этап

➡️ **Этап 1:** Разработка детерминированной генерации SQL
