# Отчёт об исследовании базы данных

**Дата:** 15 октября 2025
**Этап:** 0 (Комплексное исследование базы данных)
**База данных:** `data/thermo_data.db`

---

## Общая статистика

- **Всего записей:** 316,434
- **Уникальных формул:** 32,790
- **Количество столбцов:** 23 (не 32, как предполагалось)
- **Соотношение дубликатов:** 89.64% (в среднем 9.6 записей на уникальную формулу)

### Распределение по классам надёжности (ReliabilityClass)

| ReliabilityClass | Количество записей | Процент |
|-----------------|-------------------|---------|
| 1               | 236,236           | 74.66%  |
| 2               | 73,808            | 23.32%  |
| 3               | 5,664             | 1.79%   |
| 0               | 697               | 0.22%   |
| 4               | 18                | 0.01%   |
| 5               | 11                | 0.00%   |

**Вывод:** Большинство данных (74.66%) имеют высший класс надёжности (1), что обеспечивает хорошую основу для детерминированной логики.

---

## Анализ химических формул

### Основные паттерны

- **Формулы с фазами в скобках:** 272,647 (86.2% всех записей)
- **Ионные формы (с зарядами):** 25,131 (7.9% всех записей)
- **Уникальные формулы после TRIM:** 32,790 (также 32,790)

### Примеры вариативности написания

1. **H2O:**
   - Базовая формула: 40 записей
   - С фазами в скобках: 1,444 записи
   - Общий охват: 1,484 записи

2. **Fe:**
   - Всего соединений с Fe: 3,606 записей
   - Ионные формы Fe+: 0 записей (ожидаемо, так как ионы представлены иначе)

3. **TiO2:**
   - Базовые записи: 16
   - С модификаторами (полиморфы): 54 записи

### Рекомендации по поиску

1. **Основная стратегия:** `TRIM(Formula) = 'H2O'`
2. **Дополнительная стратегия:** `Formula LIKE 'H2O(%'` для поиска с фазами
3. **Ионные формы:** использовать `Formula LIKE '%+%' OR Formula LIKE '%-%'`

---

## Температурные диапазоны

### Статистика покрытия

- **Минимальная температура:** 0.00015 K
- **Максимальная температура:** 100,000 K
- **Записи с Tmin:** 316,434 (100%)
- **Записи с Tmax:** 316,434 (100%)
- **Записи с обеими границами:** 316,434 (100%)

### Распределение по температурным диапазонам

| Диапазон Tmin    | Количество записей |
|-----------------|-------------------|
| < 100K          | 6,629             |
| 100K - 298K     | 64,580            |
| 298K - 500K     | 155,370           |
| 500K - 1000K    | 40,115            |
| 1000K - 2000K   | 38,006            |
| > 2000K         | 11,734            |

### Интерпретация NULL значений

**Важное наблюдение:** В данной базе данных Tmin и Tmax всегда определены (100% заполнение), что отличается от первоначальных предположений. Отсутствие NULL значений упрощает фильтрацию по температуре.

---

## Фазовые состояния

### Распределение по фазам

| Фаза | Количество записей | Процент |
|------|-------------------|---------|
| g    | 173,737           | 54.9%   |
| l    | 52,753            | 16.67%  |
| s    | 50,708            | 16.02%  |
| a    | 21,778            | 6.88%   |
| ao   | 9,834             | 3.11%   |
| ai   | 7,563             | 2.39%   |
| NULL | 45                | 0.01%   |
| ?    | 8                 | 0.00%   |
| 9    | 4                 | 0.00%   |
| 2    | 3                 | 0.00%   |
| aq   | 1                 | 0.00%   |

### Данные о фазовых переходах

**Полное покрытие (100%):**
- **MeltingPoint:** 316,434 записи (100%)
- **BoilingPoint:** 316,434 записи (100%)
- **Хотя бы один переход:** 316,434 записи (100%)

### Особенности фазовых обозначений

- **Стандартные фазы:** s, l, g, aq
- **Модификаторы:** a, ao, ai (вероятно, аморфные состояния)
- **Неопределённые фазы:** ?, 9, 2 (незначительное количество)

---

## Термодинамические свойства

### Полнота данных

| Свойство | Количество записей | Процент заполнения |
|----------|-------------------|-------------------|
| H298     | 316,434           | 100%              |
| S298     | 316,434           | 100%              |
| f1       | 316,434           | 100%              |
| f2       | 316,434           | 100%              |
| f3       | 316,434           | 100%              |
| f4       | 316,434           | 100%              |
| f5       | 316,434           | 100%              |
| f6       | 316,434           | 100%              |

### Полные наборы коэффициентов

- **Полные наборы f1-f6:** 316,434 (100%)
- **Вывод:** Все записи имеют полный набор коэффициентов теплоёмкости, что обеспечивает возможность расчёта термодинамических свойств во всём температурном диапазоне.

---

## Результаты тестовых запросов

### Сценарий 1: H2O (вода в разных фазах)

- **Базовые записи H2O:** 40
- **С фазами в скобках:** 1,444
- **Температурные сценарии:**
  - 298K (комнатная температура): найдены записи
  - 273K (точка замерзания): найдены записи
  - 673K (высокая температура): найдены записи

### Сценарий 2: TiO2 + 2HCl → TiCl4 + H2O

- **TiO2:** 16 записей
- **HCl:** 153 записи (найдено с использованием LIKE 'HCl%')
- **TiCl4:** 20 записей
- **H2O:** 40 записей

**Решено:** HCl найден в базе данных при использовании комплексного подхода к поиску.

### Сценарий 3: Fe (фазовые переходы)

- **Всего Fe соединений:** 3,606 записей
- **Температурные сценарии вокруг 1811K:**
  - 1500K (ниже точки плавления): найдены записи
  - 1811K (в точке плавления): найдены записи
  - 2000K (выше точки плавления): найдены записи

### Сценарий 4: O2 (стабильность газовой фазы)

- **Всего O2 соединений:** 1,609 записей
- **Температурные сценарии:**
  - 298K: найдены записи
  - 1000K: найдены записи
  - 5000K: найдены записи

### Сценарий 5: NaCl (фазовые переходы)

- **Всего NaCl соединений:** 154 записи
- **Водные формы (фаза содержит 'a'):** 119 записей
- **Температурные сценарии:**
  - 298K: найдены записи
  - 1074K (точка плавления): найдены записи
  - 1200K (выше точки плавления): найдены записи

---

## Выявленные проблемы и ограничения

### 1. Сложности поиска соединений
- **HCl** присутствует в базе данных (153 записи), но требует комплексного подхода к поиску
- Некоторые соединения могут быть не найдены при использовании только точного совпадения `TRIM(Formula) = 'HCl'`

### 2. Фазовые обозначения
- **Неоднозначность:** фаза может быть указана в Formula (H2O(g)) и в поле Phase
- **Нестандартные обозначения:** a, ao, ai требуют дополнительной документации

### 3. Ионные формы
- **Отсутствие Fe+ форм:** ионы железа представлены иначе, чем ожидалось

### 4. Дубликаты
- **Высокий процент дубликатов:** 89.64% записей являются дубликатами с разными параметрами

---

## Рекомендации по стратегии поиска и фильтрации

### 1. Поиск по формуле

**Важно:** Многие соединения требуют комплексного подхода к поиску, так как могут быть записаны с фазовыми обозначениями в скобках.

```sql
-- Основной поиск (может не найти все записи)
SELECT * FROM compounds
WHERE TRIM(Formula) = 'H2O'
ORDER BY ReliabilityClass ASC;

-- Комплексный поиск (рекомендуется)
SELECT * FROM compounds
WHERE TRIM(Formula) = 'H2O'
   OR Formula LIKE 'H2O(%'
   OR Formula LIKE 'H2O%g%'
   OR Formula LIKE 'H2O%l%'
   OR Formula LIKE 'H2O%s%'
ORDER BY ReliabilityClass ASC;

-- Пример для HCl (требует поиска с суффиксами)
SELECT * FROM compounds
WHERE Formula LIKE 'HCl%'
ORDER BY ReliabilityClass ASC;
```

### 2. Температурная фильтрация

```sql
-- Простая температурная фильтрация (все записи имеют Tmin/Tmax)
SELECT * FROM compounds
WHERE TRIM(Formula) = 'H2O'
  AND ? >= Tmin
  AND ? <= Tmax
ORDER BY ReliabilityClass ASC;
```

### 3. Фазовая фильтрация

```sql
-- Фильтрация по фазе
SELECT * FROM compounds
WHERE TRIM(Formula) = 'H2O'
  AND Phase = 'g'
ORDER BY ReliabilityClass ASC;

-- Использование данных о фазовых переходах
SELECT * FROM compounds
WHERE TRIM(Formula) = 'H2O'
  AND ? >= MeltingPoint
  AND ? < BoilingPoint
ORDER BY ReliabilityClass ASC;
```

### 4. Приоритизация

```sql
-- Приоритизация по классу надёжности
SELECT * FROM compounds
WHERE TRIM(Formula) = 'H2O'
ORDER BY ReliabilityClass ASC, Phase;
```

### 5. Комплексный подход к поиску

**Критически важный вывод:** Первичный анализ может не найти соединение, если использовать только точное совпадение.

#### Пример с HCl:
- **Точный поиск:** `TRIM(Formula) = 'HCl'` → 0 записей
- **Комплексный поиск:** `Formula LIKE 'HCl%'` → 153 записи

#### Другие примеры:
- **CO2:** `TRIM(Formula) = 'CO2'` → 0 записей, `Formula LIKE 'CO2%'` → 1428 записей
- **NH3:** `TRIM(Formula) = 'NH3'` → 1 запись, `Formula LIKE 'NH3%'` → 1710 записей
- **CH4:** `TRIM(Formula) = 'CH4'` → 0 записей, `Formula LIKE 'CH4%'` → 1352 записей

#### Рекомендуемый алгоритм поиска:
1. **Шаг 1:** Точный поиск `TRIM(Formula) = 'соединение'`
2. **Шаг 2:** Если результатов нет, расширенный поиск `Formula LIKE 'соединение%'`
3. **Шаг 3:** Если результатов нет, общий поиск `Formula LIKE '%соединение%'`
4. **Шаг 4:** Проверка синонимов и альтернативных записей

---

## Предлагаемая архитектура фильтрации

### Стадия 1: Поиск по формуле (в SQL)
- **Точный поиск:** `TRIM(Formula) = 'H2O'`
- **Расширенный поиск:** `Formula LIKE 'H2O(%'`
- **Префиксный поиск:** `Formula LIKE 'H2O%'` (для соединений типа HCl)
- **Общий поиск:** `Formula LIKE '%H2O%'` (для сложных соединений)
- Удаление дубликатов на основе ReliabilityClass

### Стадия 2: Температурная фильтрация
- Простая фильтрация: `Tmin <= ? <= Tmax`
- Использование MeltingPoint/BoilingPoint для определения фазы

### Стадия 3: Фазовая селекция
- Приоритет заданной фазы пользователя
- Автоматическое определение фазы по температуре
- Использование данных о фазовых переходах

### Стадия 4: Приоритизация
- Сортировка по ReliabilityClass (1, 2, 3, ...)
- Устранение дубликатов
- Выбор оптимальной записи

---

## Критерии успеха для следующего этапа

✅ **Завершено:**
1. Анализ структуры данных (23 поля, не 32)
2. Статистика NULL значений (практически отсутствуют)
3. Анализ химических формул и вариативности
4. Температурные характеристики и покрытие
5. Фазовые состояния и переходы
6. Термодинамические свойства (100% заполнение)
7. Тестовые запросы для реальных сценариев

✅ **Выявлено:**
1. Высокое качество данных (74.66% с ReliabilityClass = 1)
2. Полное покрытие температурных диапазонов
3. 100% заполнение термодинамических свойств
4. Необходимость обработки дубликатов
5. **Необходимость комплексного подхода к поиску** - многие соединения могут быть не найдены при использовании только точного совпадения

---

## Рекомендации для Этапа 1

1. **Фокус на детерминированной логике:** высокое качество данных позволяет заменить LLM на строгие правила
2. **Обработка дубликатов:** разработка алгоритма выбора лучшей записи из дубликатов
3. **Температурная фильтрация:** использование MeltingPoint/BoilingPoint для определения фазы
4. **Комплексный поиск по формуле:** реализация многоуровневого алгоритма поиска (точный → префиксный → общий)
5. **Кэширование результатов:** для оптимизации повторных запросов с разными уровнями поиска

---

**Следующий этап:** Этап 1 - Разработка детерминированной генерации SQL

**Статус Этапа 0:** ✅ Завершён успешно