"""
–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞.

–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏, –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏–Ω–≤–µ—Ä—Å–∏–∏,
—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è –∏ –¥–∞–µ—Ç –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
"""

import pandas as pd
import numpy as np
from typing import Optional, Dict, List, Tuple
from ..models.extraction import ExtractedReactionParameters


class InterpretationFormatter:
    """
    –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞.
    """

    @staticmethod
    def find_inversion_temperature(df_result: pd.DataFrame) -> Optional[float]:
        """
        –ù–∞—Ö–æ–¥–∏—Ç —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–π ŒîG –º–µ–Ω—è–µ—Ç –∑–Ω–∞–∫.

        Args:
            df_result: DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞

        Returns:
            –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏–Ω–≤–µ—Ä—Å–∏–∏ (K) –∏–ª–∏ None, –µ—Å–ª–∏ ŒîG –Ω–µ –º–µ–Ω—è–µ—Ç –∑–Ω–∞–∫
        """
        # –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É, –≥–¥–µ ŒîG –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ 0
        for i in range(len(df_result) - 1):
            dG_current = df_result.iloc[i]['delta_G']
            dG_next = df_result.iloc[i + 1]['delta_G']

            if dG_current * dG_next < 0:  # –†–∞–∑–Ω—ã–µ –∑–Ω–∞–∫–∏
                # –õ–∏–Ω–µ–π–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è
                T_current = df_result.iloc[i]['T']
                T_next = df_result.iloc[i + 1]['T']

                T_inversion = T_current - dG_current * (T_next - T_current) / (dG_next - dG_current)
                return round(T_inversion, 0)

        return None

    @staticmethod
    def analyze_spontaneity_ranges(df_result: pd.DataFrame) -> Dict[str, Tuple[float, float]]:
        """
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω—ã —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–µ—Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏.

        Args:
            df_result: DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞

        Returns:
            –°–ª–æ–≤–∞—Ä—å —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Ä–µ–∞–∫—Ü–∏–∏
        """
        spontaneous_ranges = []
        non_spontaneous_ranges = []
        equilibrium_points = []

        for _, row in df_result.iterrows():
            T = row['T']
            delta_G = row['delta_G']

            if abs(delta_G) < 1000:  # |ŒîG| < 1 –∫–î–∂/–º–æ–ª—å
                equilibrium_points.append(T)
            elif delta_G < 0:
                spontaneous_ranges.append(T)
            else:
                non_spontaneous_ranges.append(T)

        result = {}

        if spontaneous_ranges:
            result['spontaneous'] = (min(spontaneous_ranges), max(spontaneous_ranges))

        if non_spontaneous_ranges:
            result['non_spontaneous'] = (min(non_spontaneous_ranges), max(non_spontaneous_ranges))

        if equilibrium_points:
            result['equilibrium'] = (min(equilibrium_points), max(equilibrium_points))

        return result

    @staticmethod
    def get_key_temperatures(df_result: pd.DataFrame) -> List[Tuple[float, Dict[str, float]]]:
        """
        –ü–æ–ª—É—á–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ K.

        Args:
            df_result: DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ä–∞—Å—á–µ—Ç–∞

        Returns:
            –°–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π (—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞, –¥–∞–Ω–Ω—ã–µ) –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫
        """
        key_temps = []

        # –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã
        standard_temps = [298.15, 500, 1000, 1500, 2000, 2500]

        for T in standard_temps:
            # –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à—É—é –¥–æ—Å—Ç—É–ø–Ω—É—é —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É
            closest_row = df_result.iloc[(df_result['T'] - T).abs().argsort()[:1]]

            if not closest_row.empty:
                row = closest_row.iloc[0]
                key_temps.append((row['T'], {
                    'delta_G': row['delta_G'],
                    'K': row['K']
                }))

        return key_temps

    @staticmethod
    def format_equilibrium_constant(K: float) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç—É —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è –≤ –Ω–∞—É—á–Ω–æ–π –Ω–æ—Ç–∞—Ü–∏–∏.

        Args:
            K: –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è

        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
        """
        if K == 0:
            return "0"
        elif K == np.inf:
            return "‚àû"
        elif K < 1e-10:
            return f"{K:.2e}"
        elif K > 1e10:
            return f"{K:.2e}"
        else:
            return f"{K:.2f}"

    def format_interpretation(
        self,
        df_result: pd.DataFrame,
        params: ExtractedReactionParameters
    ) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

        –í–∫–ª—é—á–∞–µ—Ç:
        1. –ê–Ω–∞–ª–∏–∑ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö
        2. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—ã –∏–Ω–≤–µ—Ä—Å–∏–∏ (–≥–¥–µ ŒîG = 0)
        3. –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è K
        4. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

        Args:
            df_result: DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
            params: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∞–∫—Ü–∏–∏ –∏–∑ LLM

        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è
        """
        lines = []

        # –ó–∞–≥–æ–ª–æ–≤–æ–∫
        lines.append("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
        lines.append("–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
        lines.append("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")
        lines.append("")

        # –ê–Ω–∞–ª–∏–∑ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏
        ranges = self.analyze_spontaneity_ranges(df_result)
        lines.append("–ê–Ω–∞–ª–∏–∑ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏:")
        lines.append("")

        if 'non_spontaneous' in ranges:
            T_min, T_max = ranges['non_spontaneous']
            lines.append(f"  üìâ –ü—Ä–∏ –Ω–∏–∑–∫–∏—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö ({T_min:.0f}-{T_max:.0f} K):")
            lines.append("     ŒîG > 0 ‚Üí –†–µ–∞–∫—Ü–∏—è –Ω–µ—Å–∞–º–æ–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è (—Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–µ–≤—ã–≥–æ–¥–Ω–∞)")
            lines.append("     –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–µ—à–Ω–µ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è –ø—Ä–æ—Ç–µ–∫–∞–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏")
            lines.append("")

        if 'spontaneous' in ranges:
            T_min, T_max = ranges['spontaneous']
            lines.append(f"  üìà –ü—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö ({T_min:.0f}-{T_max:.0f} K):")
            lines.append("     ŒîG < 0 ‚Üí –†–µ–∞–∫—Ü–∏—è —Å–∞–º–æ–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–∞—è (—Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–≥–æ–¥–Ω–∞)")
            lines.append("     –†–µ–∞–∫—Ü–∏—è –ø—Ä–æ—Ç–µ–∫–∞–µ—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ –≤ –ø—Ä—è–º–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–∏")
            lines.append("")

        # –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏–Ω–≤–µ—Ä—Å–∏–∏
        T_inversion = self.find_inversion_temperature(df_result)
        if T_inversion is not None:
            lines.append(f"  üéØ –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏–Ω–≤–µ—Ä—Å–∏–∏: ~{T_inversion:.0f} K")
            lines.append(f"     –ü—Ä–∏ T > {T_inversion:.0f} K —Ä–µ–∞–∫—Ü–∏—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–≥–æ–¥–Ω–æ–π")
            lines.append("")
        else:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ–≥–¥–∞ –ª–∏ —Ä–µ–∞–∫—Ü–∏—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω–∞ –∏–ª–∏ –Ω–µ—Å–ø–æ–Ω—Ç–∞–Ω–Ω–∞
            first_dG = df_result.iloc[0]['delta_G']
            last_dG = df_result.iloc[-1]['delta_G']

            if first_dG > 0 and last_dG > 0:
                lines.append("  ‚ö†Ô∏è –†–µ–∞–∫—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–µ–≤—ã–≥–æ–¥–Ω–∞ –≤–æ –≤—Å–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä")
            elif first_dG < 0 and last_dG < 0:
                lines.append("  ‚úÖ –†–µ–∞–∫—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–≥–æ–¥–Ω–∞ –≤–æ –≤—Å–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä")
            lines.append("")

        # –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è
        lines.append("–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è:")
        lines.append("")

        key_temps = self.get_key_temperatures(df_result)
        for T, data in key_temps:
            K = data['K']
            K_formatted = self.format_equilibrium_constant(K)

            if K < 1e-3:
                shift = "—Ä–µ–∞–∫—Ü–∏—è —Å–¥–≤–∏–Ω—É—Ç–∞ –≤–ª–µ–≤–æ (–æ–±—Ä–∞—Ç–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç)"
            elif K > 1e3:
                shift = "—Ä–µ–∞–∫—Ü–∏—è —Å–¥–≤–∏–Ω—É—Ç–∞ –≤–ø—Ä–∞–≤–æ (–ø—Ä—è–º–∞—è —Ä–µ–∞–∫—Ü–∏—è –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç)"
            else:
                shift = "—Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–∞–≥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤"

            lines.append(f"  –ü—Ä–∏ {T:.0f} K: K = {K_formatted} ({shift})")

        lines.append("")

        # –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥
        lines.append("–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:")
        lines.append("")

        if T_inversion is not None:
            lines.append(f"  ‚úÖ –î–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –≤—ã—à–µ {T_inversion:.0f} K")
            if T_inversion > 700:
                lines.append(f"  ‚ö†Ô∏è –ü—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞—Ö –Ω–∏–∂–µ {T_inversion-100:.0f} K –Ω–µ–æ–±—Ö–æ–¥–∏–º –∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä –∏–ª–∏ –≤–Ω–µ—à–Ω–µ–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ")
        else:
            first_dG = df_result.iloc[0]['delta_G']
            if first_dG < 0:
                lines.append("  ‚úÖ –†–µ–∞–∫—Ü–∏—è —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≤—ã–≥–æ–¥–Ω–∞ –≤–æ –≤—Å–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä")
                lines.append("     –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–æ–≤–æ–¥–∏—Ç—å –ø—Ä–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ")
            else:
                lines.append("  ‚ùå –†–µ–∞–∫—Ü–∏—è —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–µ–≤—ã–≥–æ–¥–Ω–∞")
                lines.append("     –¢—Ä–µ–±—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π (–¥–∞–≤–ª–µ–Ω–∏–µ, –∫–∞—Ç–∞–ª–∏–∑–∞—Ç–æ—Ä) –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—É—Ç–∏")

        lines.append("")
        lines.append("‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê")

        return "\n".join(lines)

    def format_technical_recommendations(
        self,
        df_result: pd.DataFrame,
        params: ExtractedReactionParameters
    ) -> str:
        """
        –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∞–∫—Ü–∏–∏.

        Args:
            df_result: DataFrame —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
            params: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–µ–∞–∫—Ü–∏–∏

        Returns:
            –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        """
        lines = []

        lines.append("–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:")
        lines.append("")

        # –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ LLM
        lines.append("  ‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ! –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ä–µ–∞–≥–∏—Ä—É—é—â–∏—Ö –≤–µ—â–µ—Å—Ç–≤ –∏ —É—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–ª–æ—Å—å –ø—Ä–∏ –ø–æ–º–æ—â–∏ AI (LLM).")
        lines.append("     –≠—Ç–æ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –º–æ–∂–µ—Ç –¥–æ–ø—É—Å–∫–∞—Ç—å –æ—à–∏–±–∫–∏. –ï—Å–ª–∏ –≤—ã –∑–∞–º–µ—Ç–∏–ª–∏, —á—Ç–æ —Ä–µ–∞–∫—Ü–∏—è –ø–æ–¥–æ–±—Ä–∞–Ω–∞ –Ω–µ–≤–µ—Ä–Ω–æ –∏–ª–∏")
        lines.append("     –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Ä–∞–≤–Ω—è–ª–∞—Å—å, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–π—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–≤ —Ç–æ—á–Ω–æ–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–∏")
        lines.append("     –∏ –Ω–∞–∑–≤–∞–Ω–∏—è –≤–µ—â–µ—Å—Ç–≤ –ø–æ –ò–Æ–ü–ê–ö (–ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–æ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ).")
        lines.append("")

        # –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω
        spontaneous_ranges = self.analyze_spontaneity_ranges(df_result)

        if 'spontaneous' in spontaneous_ranges:
            T_min, T_max = spontaneous_ranges['spontaneous']
            lines.append(f"  üå°Ô∏è –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω: {T_min:.0f}-{T_max:.0f} K")

            # –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤
            if T_max < 500:
                lines.append("     ‚Ä¢ –ù–∏–∑–∫–æ—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å - –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –≤ –æ–±—ã—á–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö")
            elif T_max < 1000:
                lines.append("     ‚Ä¢ –°—Ä–µ–¥–Ω–µ—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—á—å –∏–ª–∏ –Ω–∞–≥—Ä–µ–≤–∞—Ç–µ–ª—å")
            else:
                lines.append("     ‚Ä¢ –í—ã—Å–æ–∫–æ—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ")

  
        # –†–∞–±–æ—á–µ–µ –¥–∞–≤–ª–µ–Ω–∏–µ
        lines.append("")
        lines.append("  üîß –î–∞–≤–ª–µ–Ω–∏–µ:")
        lines.append("     ‚Ä¢ –†–∞—Å—á–µ—Ç—ã –ø—Ä–æ–≤–µ–¥–µ–Ω—ã –¥–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è (1 –∞—Ç–º)")
        lines.append("     ‚Ä¢ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –¥–∞–≤–ª–µ–Ω–∏—è –º–æ–∂–µ—Ç —Å–º–µ—Å—Ç–∏—Ç—å —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ –¥–ª—è —Ä–µ–∞–∫—Ü–∏–π —Å –≥–∞–∑–∞–º–∏")

        return "\n".join(lines)